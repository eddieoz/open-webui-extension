var ze=Object.defineProperty;var Ne=(l,t,e)=>t in l?ze(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var ce=(l,t,e)=>(Ne(l,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}})();function Q(){}function Pe(l){return l()}function fe(){return Object.create(null)}function G(l){l.forEach(Pe)}function Te(l){return typeof l=="function"}function Ie(l,t){return l!=l?t==t:l!==t||l&&typeof l=="object"||typeof l=="function"}function qe(l){return Object.keys(l).length===0}function i(l,t){l.appendChild(t)}function U(l,t,e){l.insertBefore(t,e||null)}function H(l){l.parentNode&&l.parentNode.removeChild(l)}function Ke(l,t){for(let e=0;e<l.length;e+=1)l[e]&&l[e].d(t)}function p(l){return document.createElement(l)}function Z(l){return document.createElementNS("http://www.w3.org/2000/svg",l)}function le(l){return document.createTextNode(l)}function C(){return le(" ")}function Ve(){return le("")}function P(l,t,e,n){return l.addEventListener(t,e,n),()=>l.removeEventListener(t,e,n)}function o(l,t,e){e==null?l.removeAttribute(t):l.getAttribute(t)!==e&&l.setAttribute(t,e)}function Ye(l){return Array.from(l.childNodes)}function Ae(l,t){t=""+t,l.data!==t&&(l.data=t)}function V(l,t){l.value=t??""}function me(l,t,e){for(let n=0;n<l.options.length;n+=1){const r=l.options[n];if(r.__value===t){r.selected=!0;return}}(!e||t!==void 0)&&(l.selectedIndex=-1)}function Qe(l){const t=l.querySelector(":checked");return t&&t.__value}let re;function oe(l){re=l}function Ze(){if(!re)throw new Error("Function called outside component initialization");return re}function Ge(l){Ze().$$.on_mount.push(l)}const ee=[],ge=[];let te=[];const pe=[],Je=Promise.resolve();let we=!1;function Xe(){we||(we=!0,Je.then(Re))}function ie(l){te.push(l)}const ue=new Set;let $=0;function Re(){if($!==0)return;const l=re;do{try{for(;$<ee.length;){const t=ee[$];$++,oe(t),$e(t.$$)}}catch(t){throw ee.length=0,$=0,t}for(oe(null),ee.length=0,$=0;ge.length;)ge.pop()();for(let t=0;t<te.length;t+=1){const e=te[t];ue.has(e)||(ue.add(e),e())}te.length=0}while(ee.length);for(;pe.length;)pe.pop()();we=!1,ue.clear(),oe(l)}function $e(l){if(l.fragment!==null){l.update(),G(l.before_update);const t=l.dirty;l.dirty=[-1],l.fragment&&l.fragment.p(l.ctx,t),l.after_update.forEach(ie)}}function et(l){const t=[],e=[];te.forEach(n=>l.indexOf(n)===-1?t.push(n):e.push(n)),e.forEach(n=>n()),te=t}const de=new Set;let tt;function Fe(l,t){l&&l.i&&(de.delete(l),l.i(t))}function lt(l,t,e,n){if(l&&l.o){if(de.has(l))return;de.add(l),tt.c.push(()=>{de.delete(l)}),l.o(t)}}function he(l){return(l==null?void 0:l.length)!==void 0?l:Array.from(l)}function nt(l){l&&l.c()}function He(l,t,e){const{fragment:n,after_update:r}=l.$$;n&&n.m(t,e),ie(()=>{const s=l.$$.on_mount.map(Pe).filter(Te);l.$$.on_destroy?l.$$.on_destroy.push(...s):G(s),l.$$.on_mount=[]}),r.forEach(ie)}function je(l,t){const e=l.$$;e.fragment!==null&&(et(e.after_update),G(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function ot(l,t){l.$$.dirty[0]===-1&&(ee.push(l),Xe(),l.$$.dirty.fill(0)),l.$$.dirty[t/31|0]|=1<<t%31}function Oe(l,t,e,n,r,s,a=null,d=[-1]){const m=re;oe(l);const h=l.$$={fragment:null,ctx:[],props:s,update:Q,not_equal:r,bound:fe(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(m?m.$$.context:[])),callbacks:fe(),dirty:d,skip_bound:!1,root:t.target||m.$$.root};a&&a(h.root);let w=!1;if(h.ctx=e?e(l,t.props||{},(u,c,...y)=>{const f=y.length?y[0]:c;return h.ctx&&r(h.ctx[u],h.ctx[u]=f)&&(!h.skip_bound&&h.bound[u]&&h.bound[u](f),w&&ot(l,u)),c}):[],h.update(),w=!0,G(h.before_update),h.fragment=n?n(h.ctx):!1,t.target){if(t.hydrate){const u=Ye(t.target);h.fragment&&h.fragment.l(u),u.forEach(H)}else h.fragment&&h.fragment.c();t.intro&&Fe(l.$$.fragment),He(l,t.target,t.anchor),Re()}oe(m)}class Be{constructor(){ce(this,"$$");ce(this,"$$set")}$destroy(){je(this,1),this.$destroy=Q}$on(t,e){if(!Te(e))return Q;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const r=n.indexOf(e);r!==-1&&n.splice(r,1)}}$set(t){this.$$set&&!qe(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const rt="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(rt);const be=async(l,t)=>{var e;try{if(typeof chrome>"u"||!chrome.runtime)throw new Error("Chrome extension API not available");const n=await chrome.runtime.sendMessage({action:"fetchModels",key:l,url:t});if(!n.success)throw new Error(n.error);let r=((e=n.data)==null?void 0:e.data)??[];return r=r.filter(s=>s).sort((s,a)=>{const d=s.name.toLowerCase(),m=a.name.toLowerCase();return d<m?-1:d>m?1:s<a?-1:s>a?1:0}),console.log(r),r}catch(n){throw console.log(n),n}},ye=async()=>{try{if(typeof chrome>"u"||!chrome.runtime)throw new Error("Chrome extension API not available");const l=await chrome.runtime.sendMessage({action:"getPageContent"});if(!l.success)throw new Error(l.error);return l.data}catch(l){throw console.error("Error getting page content:",l),l}};function xe(l,t,e){const n=l.slice();return n[12]=t[e],n}function _e(l){let t,e,n;function r(d,m){return d[2]?dt:st}let s=r(l),a=s(l);return{c(){t=p("div"),a.c(),o(t,"class","tlwd-fixed tlwd-top-0 tlwd-right-0 tlwd-left-0 tlwd-bottom-0 tlwd-w-full tlwd-min-h-screen tlwd-h-screen tlwd-flex tlwd-justify-center tlwd-z-[9999999999] tlwd-overflow-hidden tlwd-overscroll-contain")},m(d,m){U(d,t,m),a.m(t,null),e||(n=P(t,"mousedown",l[30]),e=!0)},p(d,m){s===(s=r(d))&&a?a.p(d,m):(a.d(1),a=s(d),a&&(a.c(),a.m(t,null)))},d(d){d&&H(t),a.d(),e=!1,n()}}}function st(l){let t,e,n,r,s,a,d,m,h,w,u,c,y,f,k,R,T,M,x,j,Y,D,N,q,L,I,v,W,ne,se,O=l[0]&&ve(),F=l[9]&&ke(l);return{c(){t=p("div"),e=p("div"),n=p("form"),r=p("div"),s=p("label"),a=p("input"),d=C(),m=p("div"),h=p("div"),O&&O.c(),u=C(),c=p("span"),c.textContent="Ask about this page",y=C(),f=p("div"),f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="tlwd-w-3 tlwd-h-3 tlwd-text-gray-500 hover:tlwd-text-gray-400 tlwd-transition-colors tlwd-duration-200" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z"></path></svg>',k=C(),R=p("div"),T=p("div"),T.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"></path></svg>`,M=C(),x=p("input"),Y=C(),D=p("div"),N=p("div"),N.textContent="Press ⌘Space+Shift to toggle",q=C(),L=p("button"),L.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-3"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 14.5M14.25 3.104c.251.023.501.05.75.082M19.8 14.5l-7.058 7.058a2.25 2.25 0 01-1.591.659H8.25a2.25 2.25 0 01-2.25-2.25V16.06a2.25 2.25 0 01.659-1.591L13.717 7.41a2.25 2.25 0 011.591-.659h2.892a2.25 2.25 0 012.25 2.25v2.892c0 .597-.237 1.17-.659 1.591z"></path></svg>`,I=C(),v=p("button"),v.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-3"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"></path></svg>`,W=C(),F&&F.c(),o(a,"id","context-toggle"),o(a,"type","checkbox"),o(a,"class","tlwd-sr-only tlwd-focus:tlwd-ring-2 tlwd-focus:tlwd-ring-blue-500"),o(a,"aria-describedby","context-toggle-description"),o(a,"aria-label","Include current page content in your question"),o(h,"class",w="tlwd-w-4 tlwd-h-4 tlwd-rounded tlwd-border tlwd-transition-all tlwd-duration-200 "+(l[0]?"tlwd-bg-blue-500 tlwd-border-blue-500 tlwd-shadow-sm":"tlwd-border-gray-400 tlwd-bg-transparent hover:tlwd-border-gray-300")),o(m,"class","tlwd-relative tlwd-transition-colors tlwd-duration-200"),o(c,"class","tlwd-text-neutral-300 tlwd-select-none tlwd-transition-colors tlwd-duration-200 hover:tlwd-text-neutral-200"),o(f,"class","tlwd-flex tlwd-items-center tlwd-ml-1"),o(f,"id","context-toggle-description"),o(f,"role","tooltip"),o(f,"aria-label","When enabled, your question will include the current page's content as context for more relevant answers"),o(s,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-cursor-pointer tlwd-text-sm tlwd-focus-within:tlwd-outline tlwd-focus-within:tlwd-outline-2 tlwd-focus-within:tlwd-outline-blue-500 tlwd-focus-within:tlwd-outline-offset-2 tlwd-rounded"),o(s,"for","context-toggle"),o(r,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full tlwd-mb-3"),o(T,"class","tlwd-flex tlwd-items-center"),o(x,"id","open-webui-search-input"),o(x,"placeholder",j=l[0]?"Ask about this page...":"Search Open WebUI"),o(x,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),o(x,"autocomplete","one-time-code"),o(R,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full"),o(N,"class","tlwd-text-right tlwd-text-[0.7rem] tlwd-p-0 tlwd-m-0 tlwd-text-neutral-300 tlwd-h-fit"),o(L,"class","tlwd-h-fit tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-yellow-400 tlwd-cursor-pointer tlwd-p-0 tlwd-m-0 tlwd-outline-none tlwd-border-none tlwd-mr-1"),o(L,"type","button"),o(L,"title","Test Content Extraction"),o(v,"class","tlwd-h-fit tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-p-0 tlwd-m-0 tlwd-outline-none tlwd-border-none"),o(v,"type","button"),o(D,"class","tlwd-flex tlwd-justify-end tlwd-gap-1 tlwd-items-center"),o(n,"class","tlwd-text-gray-200 tlwd-w-full tlwd-p-0 tlwd-m-0"),o(n,"autocomplete","off"),o(e,"class","tlwd-w-full tlwd-flex tlwd-flex-col tlwd-justify-between tlwd-py-2.5 tlwd-px-3.5 tlwd-rounded-2xl tlwd-outline tlwd-outline-1 tlwd-outline-gray-850 tlwd-backdrop-blur-3xl tlwd-bg-gray-850/70 shadow-4xl modal-animation"),o(t,"class","tlwd-m-auto tlwd-max-w-xl tlwd-w-full tlwd-pb-32")},m(B,K){U(B,t,K),i(t,e),i(e,n),i(n,r),i(r,s),i(s,a),a.checked=l[0],i(s,d),i(s,m),i(m,h),O&&O.m(h,null),i(s,u),i(s,c),i(s,y),i(s,f),i(n,k),i(n,R),i(R,T),i(R,M),i(R,x),V(x,l[5]),i(n,Y),i(n,D),i(D,N),i(D,q),i(D,L),i(D,I),i(D,v),i(e,W),F&&F.m(e,null),ne||(se=[P(a,"change",l[24]),P(a,"click",ft),P(a,"keydown",l[25]),P(x,"input",l[26]),P(L,"click",l[18]),P(v,"click",l[27]),P(n,"submit",l[13]),P(n,"mousedown",mt)],ne=!0)},p(B,K){K[0]&1&&(a.checked=B[0]),B[0]?O||(O=ve(),O.c(),O.m(h,null)):O&&(O.d(1),O=null),K[0]&1&&w!==(w="tlwd-w-4 tlwd-h-4 tlwd-rounded tlwd-border tlwd-transition-all tlwd-duration-200 "+(B[0]?"tlwd-bg-blue-500 tlwd-border-blue-500 tlwd-shadow-sm":"tlwd-border-gray-400 tlwd-bg-transparent hover:tlwd-border-gray-300"))&&o(h,"class",w),K[0]&1&&j!==(j=B[0]?"Ask about this page...":"Search Open WebUI")&&o(x,"placeholder",j),K[0]&32&&x.value!==B[5]&&V(x,B[5]),B[9]?F?F.p(B,K):(F=ke(B),F.c(),F.m(e,null)):F&&(F.d(1),F=null)},d(B){B&&H(t),O&&O.d(),F&&F.d(),ne=!1,G(se)}}}function dt(l){let t,e,n,r,s,a,d,m,h,w,u,c,y,f,k,R,T,M=l[6]&&l[6].length>0&&Se(l);return{c(){t=p("div"),e=p("div"),n=p("form"),r=p("div"),s=p("div"),s.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"></path></svg>`,a=C(),d=p("input"),m=C(),h=p("div"),w=p("div"),w.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z"></path></svg>`,u=C(),c=p("input"),y=C(),f=p("button"),f.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"></path></svg>`,k=C(),M&&M.c(),o(s,"class","tlwd-flex tlwd-items-center"),o(d,"id","open-webui-url-input"),o(d,"placeholder","Open WebUI URL"),o(d,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),o(d,"autocomplete","one-time-code"),d.required=!0,o(r,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full"),o(w,"class","tlwd-flex tlwd-items-center"),o(c,"placeholder","Open WebUI API Key"),o(c,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),o(c,"autocomplete","one-time-code"),c.required=!0,o(f,"class","tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-p-0 tlwd-m-0 tlwd-outline-none tlwd-border-none"),o(f,"type","button"),o(h,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full tlwd-mt-2"),o(n,"class","tlwd-text-gray-200 tlwd-w-full tlwd-p-0 tlwd-m-0"),o(n,"autocomplete","off"),o(e,"class","tlwd-w-full tlwd-flex tlwd-flex-col tlwd-justify-between tlwd-py-2.5 tlwd-px-3.5 tlwd-rounded-2xl tlwd-outline tlwd-outline-1 tlwd-outline-gray-850 tlwd-backdrop-blur-3xl tlwd-bg-gray-850/70 shadow-4xl modal-animation"),o(t,"class","tlwd-m-auto tlwd-max-w-sm tlwd-w-full tlwd-pb-32")},m(x,j){U(x,t,j),i(t,e),i(e,n),i(n,r),i(r,s),i(r,a),i(r,d),V(d,l[3]),i(n,m),i(n,h),i(h,w),i(h,u),i(h,c),V(c,l[4]),i(h,y),i(h,f),i(n,k),M&&M.m(n,null),R||(T=[P(d,"input",l[20]),P(c,"input",l[21]),P(f,"click",l[22]),P(n,"submit",l[19]),P(n,"mousedown",wt)],R=!0)},p(x,j){j[0]&8&&d.value!==x[3]&&V(d,x[3]),j[0]&16&&c.value!==x[4]&&V(c,x[4]),x[6]&&x[6].length>0?M?M.p(x,j):(M=Se(x),M.c(),M.m(n,null)):M&&(M.d(1),M=null)},d(x){x&&H(t),M&&M.d(),R=!1,G(T)}}}function ve(l){let t,e;return{c(){t=Z("svg"),e=Z("path"),o(e,"stroke-linecap","round"),o(e,"stroke-linejoin","round"),o(e,"d","m4.5 12.75 6 6 9-13.5"),o(t,"xmlns","http://www.w3.org/2000/svg"),o(t,"fill","none"),o(t,"viewBox","0 0 24 24"),o(t,"stroke-width",3),o(t,"stroke","currentColor"),o(t,"class","tlwd-w-3 tlwd-h-3 tlwd-text-white tlwd-absolute tlwd-top-0.5 tlwd-left-0.5 tlwd-transition-opacity tlwd-duration-200"),o(t,"role","img"),o(t,"aria-hidden","true")},m(n,r){U(n,t,r),i(t,e)},d(n){n&&H(t)}}}function ke(l){let t,e,n,r,s,a,d,m=l[7]?"AI is responding...":"Response complete",h,w,u,c,y,f,k,R,T,M,x,j,Y,D;function N(v,W){return v[8]?ct:v[7]?at:it}let q=N(l),L=q(l),I=l[11]&&l[10]&&Ce(l);return{c(){t=p("div"),e=p("div"),n=p("div"),r=p("div"),a=C(),d=p("span"),h=le(m),w=C(),u=p("div"),c=p("button"),y=Z("svg"),f=Z("path"),R=C(),T=p("button"),T.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="tlwd-w-4 tlwd-h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>',M=C(),x=p("div"),L.c(),j=C(),I&&I.c(),o(r,"class",s="tlwd-w-2 tlwd-h-2 tlwd-rounded-full "+(l[7]?"tlwd-bg-blue-500 tlwd-animate-pulse":"tlwd-bg-green-500")),o(d,"class","tlwd-text-sm tlwd-text-gray-300"),o(n,"class","tlwd-flex tlwd-items-center tlwd-gap-2"),o(f,"stroke-linecap","round"),o(f,"stroke-linejoin","round"),o(f,"d","M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"),o(y,"xmlns","http://www.w3.org/2000/svg"),o(y,"fill","none"),o(y,"viewBox","0 0 24 24"),o(y,"stroke-width",2),o(y,"stroke","currentColor"),o(y,"class","tlwd-w-4 tlwd-h-4"),o(c,"class","tlwd-p-1 tlwd-rounded tlwd-bg-transparent hover:tlwd-bg-gray-700 tlwd-text-gray-400 hover:tlwd-text-gray-200 tlwd-transition-colors tlwd-duration-200"),o(c,"type","button"),o(c,"title","Copy response"),c.disabled=k=!l[8],o(T,"class","tlwd-p-1 tlwd-rounded tlwd-bg-transparent hover:tlwd-bg-gray-700 tlwd-text-gray-400 hover:tlwd-text-gray-200 tlwd-transition-colors tlwd-duration-200"),o(T,"type","button"),o(T,"title","Clear response"),o(u,"class","tlwd-flex tlwd-items-center tlwd-gap-2"),o(e,"class","tlwd-flex tlwd-items-center tlwd-justify-between tlwd-mb-3"),o(x,"class","tlwd-max-h-96 tlwd-overflow-y-auto tlwd-text-sm tlwd-leading-relaxed"),o(t,"class","tlwd-mt-4 tlwd-p-4 tlwd-rounded-xl tlwd-bg-gray-800/50 tlwd-backdrop-blur-sm tlwd-border tlwd-border-gray-700")},m(v,W){U(v,t,W),i(t,e),i(e,n),i(n,r),i(n,a),i(n,d),i(d,h),i(e,w),i(e,u),i(u,c),i(c,y),i(y,f),i(u,R),i(u,T),i(t,M),i(t,x),L.m(x,null),i(t,j),I&&I.m(t,null),Y||(D=[P(c,"click",l[28]),P(T,"click",l[29])],Y=!0)},p(v,W){W[0]&128&&s!==(s="tlwd-w-2 tlwd-h-2 tlwd-rounded-full "+(v[7]?"tlwd-bg-blue-500 tlwd-animate-pulse":"tlwd-bg-green-500"))&&o(r,"class",s),W[0]&128&&m!==(m=v[7]?"AI is responding...":"Response complete")&&Ae(h,m),W[0]&256&&k!==(k=!v[8])&&(c.disabled=k),q===(q=N(v))&&L?L.p(v,W):(L.d(1),L=q(v),L&&(L.c(),L.m(x,null))),v[11]&&v[10]?I?I.p(v,W):(I=Ce(v),I.c(),I.m(t,null)):I&&(I.d(1),I=null)},d(v){v&&H(t),L.d(),I&&I.d(),Y=!1,G(D)}}}function it(l){let t;return{c(){t=p("div"),t.textContent="No response yet",o(t,"class","tlwd-text-gray-500")},m(e,n){U(e,t,n)},p:Q,d(e){e&&H(t)}}}function at(l){let t;return{c(){t=p("div"),t.innerHTML=`<div class="tlwd-animate-spin tlwd-w-4 tlwd-h-4 tlwd-border-2 tlwd-border-gray-600 tlwd-border-t-blue-500 tlwd-rounded-full"></div>
                    Waiting for response...`,o(t,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-text-gray-400")},m(e,n){U(e,t,n)},p:Q,d(e){e&&H(t)}}}function ct(l){let t,e=l[17](l[8])+"";return{c(){t=p("div"),o(t,"class","markdown-content")},m(n,r){U(n,t,r),t.innerHTML=e},p(n,r){r[0]&256&&e!==(e=n[17](n[8])+"")&&(t.innerHTML=e)},d(n){n&&H(t)}}}function Ce(l){let t,e,n,r,s,a,d,m,h,w=l[10].canRetry&&Me(l),u=l[10].canRetryWithoutContext&&Ee(l);return{c(){t=p("div"),e=p("div"),e.textContent="Error Recovery Options",n=C(),r=p("div"),w&&w.c(),s=C(),u&&u.c(),a=C(),d=p("button"),d.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="tlwd-w-3 tlwd-h-3"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"></path></svg>
                      Open in New Tab`,o(e,"class","tlwd-text-xs tlwd-text-gray-400 tlwd-mb-3"),o(d,"class","tlwd-px-3 tlwd-py-1.5 tlwd-text-xs tlwd-bg-gray-600 hover:tlwd-bg-gray-700 tlwd-text-white tlwd-rounded tlwd-transition-colors tlwd-duration-200 tlwd-flex tlwd-items-center tlwd-gap-1"),o(d,"type","button"),o(r,"class","tlwd-flex tlwd-flex-wrap tlwd-gap-2"),o(t,"class","tlwd-mt-4 tlwd-pt-4 tlwd-border-t tlwd-border-gray-600")},m(c,y){U(c,t,y),i(t,e),i(t,n),i(t,r),w&&w.m(r,null),i(r,s),u&&u.m(r,null),i(r,a),i(r,d),m||(h=P(d,"click",l[16]),m=!0)},p(c,y){c[10].canRetry?w?w.p(c,y):(w=Me(c),w.c(),w.m(r,s)):w&&(w.d(1),w=null),c[10].canRetryWithoutContext?u?u.p(c,y):(u=Ee(c),u.c(),u.m(r,a)):u&&(u.d(1),u=null)},d(c){c&&H(t),w&&w.d(),u&&u.d(),m=!1,h()}}}function Me(l){let t,e,n,r,s,a;return{c(){t=p("button"),e=Z("svg"),n=Z("path"),r=le(`
                        Retry with Context`),o(n,"stroke-linecap","round"),o(n,"stroke-linejoin","round"),o(n,"d","M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"fill","none"),o(e,"viewBox","0 0 24 24"),o(e,"stroke-width",2),o(e,"stroke","currentColor"),o(e,"class","tlwd-w-3 tlwd-h-3"),o(t,"class","tlwd-px-3 tlwd-py-1.5 tlwd-text-xs tlwd-bg-blue-600 hover:tlwd-bg-blue-700 tlwd-text-white tlwd-rounded tlwd-transition-colors tlwd-duration-200 tlwd-flex tlwd-items-center tlwd-gap-1"),o(t,"type","button"),t.disabled=l[7]},m(d,m){U(d,t,m),i(t,e),i(e,n),i(t,r),s||(a=P(t,"click",l[14]),s=!0)},p(d,m){m[0]&128&&(t.disabled=d[7])},d(d){d&&H(t),s=!1,a()}}}function Ee(l){let t,e,n,r,s,a;return{c(){t=p("button"),e=Z("svg"),n=Z("path"),r=le(`
                        Retry without Context`),o(n,"stroke-linecap","round"),o(n,"stroke-linejoin","round"),o(n,"d","M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"fill","none"),o(e,"viewBox","0 0 24 24"),o(e,"stroke-width",2),o(e,"stroke","currentColor"),o(e,"class","tlwd-w-3 tlwd-h-3"),o(t,"class","tlwd-px-3 tlwd-py-1.5 tlwd-text-xs tlwd-bg-orange-600 hover:tlwd-bg-orange-700 tlwd-text-white tlwd-rounded tlwd-transition-colors tlwd-duration-200 tlwd-flex tlwd-items-center tlwd-gap-1"),o(t,"type","button"),t.disabled=l[7]},m(d,m){U(d,t,m),i(t,e),i(e,n),i(t,r),s||(a=P(t,"click",l[15]),s=!0)},p(d,m){m[0]&128&&(t.disabled=d[7])},d(d){d&&H(t),s=!1,a()}}}function Se(l){let t,e,n,r,s,a,d,m,h,w=he(l[6]),u=[];for(let c=0;c<w.length;c+=1)u[c]=Le(xe(l,w,c));return{c(){t=p("div"),e=p("div"),e.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"></path></svg>`,n=C(),r=p("select"),s=p("option"),s.textContent="Select a model";for(let c=0;c<u.length;c+=1)u[c].c();a=C(),d=p("button"),d.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5"></path></svg>`,o(e,"class","tlwd-flex tlwd-items-center"),s.__value="",V(s,s.__value),o(r,"id","open-webui-model-input"),o(r,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),o(r,"autocomplete","off"),r.required=!0,l[12]===void 0&&ie(()=>l[23].call(r)),o(d,"class","tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-p-0 tlwd-m-0 tlwd-outline-none tlwd-border-none"),o(d,"type","submit"),o(t,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full tlwd-mt-2")},m(c,y){U(c,t,y),i(t,e),i(t,n),i(t,r),i(r,s);for(let f=0;f<u.length;f+=1)u[f]&&u[f].m(r,null);me(r,l[12],!0),i(t,a),i(t,d),m||(h=P(r,"change",l[23]),m=!0)},p(c,y){if(y[0]&64){w=he(c[6]);let f;for(f=0;f<w.length;f+=1){const k=xe(c,w,f);u[f]?u[f].p(k,y):(u[f]=Le(k),u[f].c(),u[f].m(r,null))}for(;f<u.length;f+=1)u[f].d(1);u.length=w.length}y[0]&4160&&me(r,c[12])},d(c){c&&H(t),Ke(u,c),m=!1,h()}}}function Le(l){let t,e=(l[12].name??l[12].id)+"",n,r;return{c(){t=p("option"),n=le(e),t.__value=r=l[12].id,V(t,t.__value)},m(s,a){U(s,t,a),i(t,n)},p(s,a){a[0]&64&&e!==(e=(s[12].name??s[12].id)+"")&&Ae(n,e),a[0]&64&&r!==(r=s[12].id)&&(t.__value=r,V(t,t.__value))},d(s){s&&H(t)}}}function ut(l){let t,e=l[1]&&_e(l);return{c(){e&&e.c(),t=Ve()},m(n,r){e&&e.m(n,r),U(n,t,r)},p(n,r){n[1]?e?e.p(n,r):(e=_e(n),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:Q,o:Q,d(n){n&&H(t),e&&e.d(n)}}}const wt=l=>{l.stopPropagation()},ft=l=>l.stopPropagation(),mt=l=>{l.stopPropagation()};function gt(l,t,e){let n=!1,r=!0,s="",a="",d="",m="",h=[],w=!0,u=!1,c="",y=!1,f=null,k=!1;const R=()=>{console.log("resetConfig");try{chrome.storage.local.clear().then(()=>{console.log("Value is cleared")})}catch(b){console.log(b),localStorage.setItem("url",""),localStorage.setItem("key",""),localStorage.setItem("model",""),localStorage.setItem("includePageContext","true")}e(3,s=""),e(4,a=""),e(12,d=""),e(6,h=[]),e(0,w=!0),e(2,r=!0),e(9,y=!1),e(8,c=""),e(7,u=!1),e(10,f=null),e(11,k=!1)},T=async b=>{var _,A;if(b.preventDefault(),!!m.trim()){if(!w){const g=`${s}/?q=${encodeURIComponent(m)}&models=${d}&web-search=true`;console.log("🔗 Opening Open WebUI in new tab with web search enabled:",{url:s,searchValue:m,model:d,fullURL:g}),window.open(g,"_blank"),e(5,m=""),e(1,n=!1);return}try{e(7,u=!0),e(9,y=!0),e(8,c=""),e(10,f=null),e(11,k=!1);let g=null,J=!1;try{console.log("📄 Extracting page content..."),g=await Promise.race([ye(),new Promise((S,z)=>setTimeout(()=>z(new Error("Content extraction timeout")),1e4))]),console.log("✅ Page content extracted successfully")}catch(S){console.warn("⚠️ Content extraction failed:",S),J=!0,e(10,f={type:"content_extraction",message:"Unable to extract page content",details:S.message,canRetryWithoutContext:!0}),e(8,c=`Unable to extract page content: ${S.message}

You can try again without page context, or retry with context.`),e(7,u=!1),e(11,k=!0);return}const X=M(m,g);console.log("🚀 Starting context-aware completion:",{userQuery:m,hasContext:!!g,contextLength:((_=g==null?void 0:g.mainContent)==null?void 0:_.length)||0});const E=await Promise.race([chrome.runtime.sendMessage({action:"fetchCompletion",url:s,key:a,isOpenAI:((A=h.find(S=>S.id===d))==null?void 0:A.owned_by)==="openai",inlineMode:!1,payload:{model:d,messages:[{role:"system",content:"You are a helpful assistant. When provided with page context, use it to give more relevant and specific answers to the user's questions."},{role:"user",content:X}],stream:!0}}),new Promise((S,z)=>setTimeout(()=>z(new Error("API request timeout")),3e4))]);if(!E.success)throw new Error(E.error)}catch(g){console.error("❌ Context-aware query failed:",g);const J=g.message.includes("timeout")||g.message.includes("network")||g.message.includes("fetch"),X=g.message.includes("API")||g.message.includes("unauthorized")||g.message.includes("400")||g.message.includes("401")||g.message.includes("500");J?(e(10,f={type:"network",message:"Network connection issue",details:g.message,canRetry:!0,canRetryWithoutContext:!0}),e(8,c=`Network Error: ${g.message}

This might be due to:
• Poor internet connection
• Server is temporarily unavailable
• Request timeout

You can retry or try without page context.`)):X?(e(10,f={type:"api",message:"AI service unavailable",details:g.message,canRetry:!0,canRetryWithoutContext:!0}),e(8,c=`API Error: ${g.message}

This might be due to:
• Invalid API key or configuration
• Server maintenance
• Rate limiting

Please check your settings or try again later.`)):(e(10,f={type:"unknown",message:"Unexpected error occurred",details:g.message,canRetry:!0,canRetryWithoutContext:!0}),e(8,c=`Unexpected Error: ${g.message}

Something went wrong. You can try again or use the fallback search.`)),e(7,u=!1),e(11,k=!0),console.error("🐛 Error details:",{type:f.type,message:f.message,details:f.details,timestamp:new Date().toISOString()})}}},M=(b,_)=>{let A="";return _&&(A+=`Context: Page Title: ${_.title||"Untitled"}
`,A+=`URL: ${_.url}
`,_.metaDescription&&(A+=`Description: ${_.metaDescription}
`),_.selectedText&&(A+=`Selected Text: ${_.selectedText}
`),A+=`Content: ${_.mainContent||"No content available"}

`),A+=`User Question: ${b}

`,_&&(A+="Please answer the user's question based on the provided page context. If the context is not relevant to the question, you can provide a general answer but mention that the context may not be directly related."),A},x=async()=>{console.log("🔄 Retrying with context..."),e(10,f=null),e(11,k=!1),await T({preventDefault:()=>{}})},j=async()=>{console.log("🔄 Retrying without context...");const b=w;e(0,w=!1),e(10,f=null),e(11,k=!1);try{await T({preventDefault:()=>{}})}finally{e(0,w=b)}},Y=()=>{console.log("🔄 Falling back to normal search with web search enabled..."),window.open(`${s}/?q=${encodeURIComponent(m)}&models=${d}&web-search=true`,"_blank"),e(5,m=""),e(1,n=!1),e(9,y=!1),e(8,c=""),e(10,f=null),e(11,k=!1)},D=b=>{if(!b)return"";let _=b.replace(/^### (.*$)/gim,'<h3 class="tlwd-text-lg tlwd-font-semibold tlwd-text-gray-100 tlwd-mt-4 tlwd-mb-2">$1</h3>').replace(/^## (.*$)/gim,'<h2 class="tlwd-text-xl tlwd-font-bold tlwd-text-gray-100 tlwd-mt-4 tlwd-mb-2">$1</h2>').replace(/^# (.*$)/gim,'<h1 class="tlwd-text-2xl tlwd-font-bold tlwd-text-gray-100 tlwd-mt-4 tlwd-mb-2">$1</h1>').replace(/\*\*\*(.*?)\*\*\*/g,'<strong class="tlwd-font-bold tlwd-text-gray-100"><em class="tlwd-italic">$1</em></strong>').replace(/\*\*(.*?)\*\*/g,'<strong class="tlwd-font-bold tlwd-text-gray-100">$1</strong>').replace(/\*(.*?)\*/g,'<em class="tlwd-italic tlwd-text-gray-200">$1</em>').replace(/```([^`]+)```/g,'<pre class="tlwd-bg-gray-800 tlwd-rounded tlwd-p-2 tlwd-mt-2 tlwd-mb-2 tlwd-text-xs tlwd-font-mono tlwd-text-gray-300 tlwd-overflow-x-auto"><code>$1</code></pre>').replace(/`([^`]+)`/g,'<code class="tlwd-bg-gray-800 tlwd-px-1 tlwd-rounded tlwd-text-xs tlwd-font-mono tlwd-text-gray-300">$1</code>').replace(/^\* (.*$)/gim,'<li class="tlwd-ml-4 tlwd-list-disc tlwd-text-gray-200 tlwd-mb-1">$1</li>').replace(/^- (.*$)/gim,'<li class="tlwd-ml-4 tlwd-list-disc tlwd-text-gray-200 tlwd-mb-1">$1</li>').replace(/^\d+\. (.*$)/gim,'<li class="tlwd-ml-4 tlwd-list-decimal tlwd-text-gray-200 tlwd-mb-1">$1</li>').replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" class="tlwd-text-blue-400 hover:tlwd-text-blue-300 tlwd-underline" target="_blank" rel="noopener noreferrer">$1</a>').replace(/\n\n/g,'</p><p class="tlwd-text-gray-200 tlwd-mb-2">').replace(/\n/g,"<br>");return _.trim()&&(_='<p class="tlwd-text-gray-200 tlwd-mb-2">'+_+"</p>"),_=_.replace(/(<li[^>]*class="[^"]*list-disc[^"]*"[^>]*>.*?<\/li>)+/g,'<ul class="tlwd-mb-2">$&</ul>'),_=_.replace(/(<li[^>]*class="[^"]*list-decimal[^"]*"[^>]*>.*?<\/li>)+/g,'<ol class="tlwd-mb-2">$&</ol>'),_},N=async()=>{try{console.log("🧪 Testing content extraction and context-aware prompt..."),console.log("📋 Toggle State:",{includePageContext:w,placeholder:w?"Ask about this page...":"Search Open WebUI"});const b=await ye();console.log("✅ Content extracted successfully:",b);const A=M("What is this page about?",b);console.log("📝 Context-aware prompt created:",A),console.log("📊 Content Summary:",{title:b.title,domain:b.domain,contentLength:b.contentLength,hasMetaDescription:!!b.metaDescription,hasSelectedText:!!b.selectedText,timestamp:b.timestamp,promptLength:A.length}),alert(`Content extraction & prompt creation successful!

Toggle State: ${w?"Enabled":"Disabled"}
Title: ${b.title}
Domain: ${b.domain}
Content Length: ${b.contentLength} chars
Prompt Length: ${A.length} chars

Check console for full details including the generated prompt.`)}catch(b){console.error("❌ Content extraction failed:",b),alert(`Content extraction failed: ${b.message}`)}},q=b=>{b.preventDefault();try{chrome.storage.local.set({url:s,key:a,model:d,includePageContext:w}).then(()=>{console.log("Value is set")})}catch(_){console.log(_),localStorage.setItem("url",s),localStorage.setItem("key",a),localStorage.setItem("model",d),localStorage.setItem("includePageContext",w.toString())}e(2,r=!1)};Ge(async()=>{let b=null;try{b=await chrome.storage.local.get()}catch(g){console.log(g)}const _=g=>{g.action==="contextStreamChunk"?e(8,c+=g.text):g.action==="contextStreamComplete"&&(console.log("🏁 Context-aware stream completed"),e(7,u=!1))};try{chrome.runtime.onMessage.addListener(_)}catch(g){console.log("Failed to add message listener:",g)}b&&(e(3,s=b.url??""),e(4,a=b.key??""),e(12,d=b.model??""),e(0,w=b.includePageContext??!0),b.url&&b.key&&b.model&&(e(6,h=await be(b.key,b.url).catch(g=>{console.log(g),R()})),h&&e(2,r=!1)));const A=async g=>{var J,X;if(n&&g.shiftKey&&g.key==="Escape"?R():g.key==="Escape"&&(y||k?(e(9,y=!1),e(8,c=""),e(7,u=!1),e(10,f=null),e(11,k=!1)):e(1,n=!1)),g.key===" "&&(g.metaKey||g.ctrlKey)&&(g.shiftKey||g.altKey)){console.log("🔧 Search shortcut triggered"),g.preventDefault();try{const E=await chrome.runtime.sendMessage({action:"getSelection"});((E==null?void 0:E.data)??!1)&&e(5,m=E.data)}catch(E){console.log("catch",E)}e(1,n=!n),setTimeout(()=>{const E=document.getElementById("open-webui-search-input");E&&E.focus()},0)}if(a!==""&&s!==""&&g.key==="Enter"&&(g.metaKey||g.ctrlKey)&&(g.shiftKey||g.altKey)){g.preventDefault();try{console.log("🔧 Direct completion triggered");const E=await chrome.runtime.sendMessage({action:"getSelection"});if(console.log("📝 Selected text:",E==null?void 0:E.data),(E==null?void 0:E.data)??!1){console.log("✅ Text selected, starting AI completion"),await chrome.runtime.sendMessage({action:"writeText",text:`
`}),console.log("🌐 Using background script for API call");const S=await chrome.runtime.sendMessage({action:"fetchCompletion",url:s,key:a,isOpenAI:((J=h.find(z=>z.id===d))==null?void 0:J.owned_by)==="openai",inlineMode:!0,payload:{model:d,messages:[{role:"system",content:"You are a helpful assistant."},{role:"user",content:E.data}],stream:!0}});S.success?console.log("🚀 Background streaming started"):(console.error("❌ Background request failed:",S.error),await chrome.runtime.sendMessage({action:"writeText",text:`Error: ${S.error}`}))}else{console.log("⚠️ No text selected, extracting page content for summarization");try{const S=await chrome.runtime.sendMessage({action:"getPageContent"});if(S.success&&S.data){const z=S.data;console.log("📄 Page content extracted for summarization"),await chrome.runtime.sendMessage({action:"writeText",text:`
`});const De=`Task: Summarize the following article. Length: 3-5 sentences. Format: Markdown. Requirements: capture the main ideas and key points; easy to understand; summary should be free from ambiguity.

Page Title: ${z.title||"Untitled"}
URL: ${z.url}
${z.metaDescription?`Description: ${z.metaDescription}
`:""}
Content: ${z.mainContent||"No content available"}`,ae=await chrome.runtime.sendMessage({action:"fetchCompletion",url:s,key:a,isOpenAI:((X=h.find(We=>We.id===d))==null?void 0:X.owned_by)==="openai",inlineMode:!0,payload:{model:d,messages:[{role:"system",content:"You are a helpful assistant that provides clear and concise summaries of web pages."},{role:"user",content:De}],stream:!0}});ae.success?console.log("🚀 Page summarization started"):(console.error("❌ Page summarization failed:",ae.error),await chrome.runtime.sendMessage({action:"writeText",text:`Error: ${ae.error}`}))}else console.error("❌ Failed to extract page content:",S.error),await chrome.runtime.sendMessage({action:"writeText",text:`Error extracting page content: ${S.error||"Unknown error"}`})}catch(S){console.error("💥 Page content extraction error:",S),await chrome.runtime.sendMessage({action:"writeText",text:`Error extracting page content: ${S.message}`})}}}catch(E){console.error("💥 Completion error:",E);try{await chrome.runtime.sendMessage({action:"writeText",text:`Error: ${E.message}`})}catch(S){console.error("Failed to send error message:",S)}}}};return document.addEventListener("keydown",A,{capture:!0}),()=>{document.removeEventListener("keydown",A);try{chrome.runtime.onMessage.removeListener(_)}catch(g){console.log("Failed to remove message listener:",g)}}});function L(){s=this.value,e(3,s)}function I(){a=this.value,e(4,a)}const v=async()=>{s.endsWith("/")&&e(3,s=s.slice(0,-1)),e(6,h=await be(a,s))};function W(){d=Qe(this),e(12,d),e(6,h)}function ne(){w=this.checked,e(0,w)}const se=b=>{b.key===" "&&(b.preventDefault(),b.stopPropagation(),e(0,w=!w))};function O(){m=this.value,e(5,m)}const F=()=>{e(2,r=!0)},B=()=>{navigator.clipboard.writeText(c)},K=()=>{e(9,y=!1),e(8,c=""),e(5,m=""),e(10,f=null),e(11,k=!1)},Ue=()=>{e(1,n=!1)};return l.$$.update=()=>{if(l.$$.dirty[0]&1&&typeof w<"u")try{chrome.storage.local.set({includePageContext:w})}catch{localStorage.setItem("includePageContext",w.toString())}},[w,n,r,s,a,m,h,u,c,y,f,k,d,T,x,j,Y,D,N,q,L,I,v,W,ne,se,O,F,B,K,Ue]}class pt extends Be{constructor(t){super(),Oe(this,t,gt,ut,Ie,{},null,[-1,-1])}}function ht(l){let t,e,n;return e=new pt({}),{c(){t=p("div"),nt(e.$$.fragment),o(t,"class","extension-container")},m(r,s){U(r,t,s),He(e,t,null),n=!0},p:Q,i(r){n||(Fe(e.$$.fragment,r),n=!0)},o(r){lt(e.$$.fragment,r),n=!1},d(r){r&&H(t),je(e)}}}class bt extends Be{constructor(t){super(),Oe(this,t,null,ht,Ie,{})}}new bt({target:document.getElementById("extension-app")});
