var Wt=Object.defineProperty;var Nt=(l,e,t)=>e in l?Wt(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var ct=(l,e,t)=>(Nt(l,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function Q(){}function Pt(l){return l()}function ft(){return Object.create(null)}function G(l){l.forEach(Pt)}function It(l){return typeof l=="function"}function Tt(l,e){return l!=l?e==e:l!==e||l&&typeof l=="object"||typeof l=="function"}function qt(l){return Object.keys(l).length===0}function a(l,e){l.appendChild(e)}function U(l,e,t){l.insertBefore(e,t||null)}function H(l){l.parentNode&&l.parentNode.removeChild(l)}function Kt(l,e){for(let t=0;t<l.length;t+=1)l[t]&&l[t].d(e)}function p(l){return document.createElement(l)}function Z(l){return document.createElementNS("http://www.w3.org/2000/svg",l)}function lt(l){return document.createTextNode(l)}function C(){return lt(" ")}function Vt(){return lt("")}function P(l,e,t,o){return l.addEventListener(e,t,o),()=>l.removeEventListener(e,t,o)}function n(l,e,t){t==null?l.removeAttribute(e):l.getAttribute(e)!==t&&l.setAttribute(e,t)}function Yt(l){return Array.from(l.childNodes)}function At(l,e){e=""+e,l.data!==e&&(l.data=e)}function V(l,e){l.value=e??""}function mt(l,e,t){for(let o=0;o<l.options.length;o+=1){const r=l.options[o];if(r.__value===e){r.selected=!0;return}}(!t||e!==void 0)&&(l.selectedIndex=-1)}function Qt(l){const e=l.querySelector(":checked");return e&&e.__value}let rt;function nt(l){rt=l}function Zt(){if(!rt)throw new Error("Function called outside component initialization");return rt}function Gt(l){Zt().$$.on_mount.push(l)}const tt=[],gt=[];let et=[];const pt=[],Jt=Promise.resolve();let wt=!1;function Xt(){wt||(wt=!0,Jt.then(Rt))}function it(l){et.push(l)}const ut=new Set;let $=0;function Rt(){if($!==0)return;const l=rt;do{try{for(;$<tt.length;){const e=tt[$];$++,nt(e),$t(e.$$)}}catch(e){throw tt.length=0,$=0,e}for(nt(null),tt.length=0,$=0;gt.length;)gt.pop()();for(let e=0;e<et.length;e+=1){const t=et[e];ut.has(t)||(ut.add(t),t())}et.length=0}while(tt.length);for(;pt.length;)pt.pop()();wt=!1,ut.clear(),nt(l)}function $t(l){if(l.fragment!==null){l.update(),G(l.before_update);const e=l.dirty;l.dirty=[-1],l.fragment&&l.fragment.p(l.ctx,e),l.after_update.forEach(it)}}function te(l){const e=[],t=[];et.forEach(o=>l.indexOf(o)===-1?e.push(o):t.push(o)),t.forEach(o=>o()),et=e}const dt=new Set;let ee;function Ft(l,e){l&&l.i&&(dt.delete(l),l.i(e))}function le(l,e,t,o){if(l&&l.o){if(dt.has(l))return;dt.add(l),ee.c.push(()=>{dt.delete(l)}),l.o(e)}}function ht(l){return(l==null?void 0:l.length)!==void 0?l:Array.from(l)}function oe(l){l&&l.c()}function Ht(l,e,t){const{fragment:o,after_update:r}=l.$$;o&&o.m(e,t),it(()=>{const s=l.$$.on_mount.map(Pt).filter(It);l.$$.on_destroy?l.$$.on_destroy.push(...s):G(s),l.$$.on_mount=[]}),r.forEach(it)}function jt(l,e){const t=l.$$;t.fragment!==null&&(te(t.after_update),G(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function ne(l,e){l.$$.dirty[0]===-1&&(tt.push(l),Xt(),l.$$.dirty.fill(0)),l.$$.dirty[e/31|0]|=1<<e%31}function Ot(l,e,t,o,r,s,c=null,d=[-1]){const m=rt;nt(l);const h=l.$$={fragment:null,ctx:[],props:s,update:Q,not_equal:r,bound:ft(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(m?m.$$.context:[])),callbacks:ft(),dirty:d,skip_bound:!1,root:e.target||m.$$.root};c&&c(h.root);let w=!1;if(h.ctx=t?t(l,e.props||{},(u,i,...y)=>{const f=y.length?y[0]:i;return h.ctx&&r(h.ctx[u],h.ctx[u]=f)&&(!h.skip_bound&&h.bound[u]&&h.bound[u](f),w&&ne(l,u)),i}):[],h.update(),w=!0,G(h.before_update),h.fragment=o?o(h.ctx):!1,e.target){if(e.hydrate){const u=Yt(e.target);h.fragment&&h.fragment.l(u),u.forEach(H)}else h.fragment&&h.fragment.c();e.intro&&Ft(l.$$.fragment),Ht(l,e.target,e.anchor),Rt()}nt(m)}class Bt{constructor(){ct(this,"$$");ct(this,"$$set")}$destroy(){jt(this,1),this.$destroy=Q}$on(e,t){if(!It(t))return Q;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(t),()=>{const r=o.indexOf(t);r!==-1&&o.splice(r,1)}}$set(e){this.$$set&&!qt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const re="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(re);const bt=async(l,e)=>{var t;try{if(typeof chrome>"u"||!chrome.runtime)throw new Error("Chrome extension API not available");const o=await chrome.runtime.sendMessage({action:"fetchModels",key:l,url:e});if(!o.success)throw new Error(o.error);let r=((t=o.data)==null?void 0:t.data)??[];return r=r.filter(s=>s).sort((s,c)=>{const d=s.name.toLowerCase(),m=c.name.toLowerCase();return d<m?-1:d>m?1:s<c?-1:s>c?1:0}),console.log(r),r}catch(o){throw console.log(o),o}},yt=async()=>{try{if(typeof chrome>"u"||!chrome.runtime)throw new Error("Chrome extension API not available");const l=await chrome.runtime.sendMessage({action:"getPageContent"});if(!l.success)throw new Error(l.error);return l.data}catch(l){throw console.error("Error getting page content:",l),l}};function xt(l,e,t){const o=l.slice();return o[12]=e[t],o}function _t(l){let e,t,o;function r(d,m){return d[2]?de:se}let s=r(l),c=s(l);return{c(){e=p("div"),c.c(),n(e,"class","tlwd-fixed tlwd-top-0 tlwd-right-0 tlwd-left-0 tlwd-bottom-0 tlwd-w-full tlwd-min-h-screen tlwd-h-screen tlwd-flex tlwd-justify-center tlwd-z-[9999999999] tlwd-overflow-hidden tlwd-overscroll-contain")},m(d,m){U(d,e,m),c.m(e,null),t||(o=P(e,"mousedown",l[30]),t=!0)},p(d,m){s===(s=r(d))&&c?c.p(d,m):(c.d(1),c=s(d),c&&(c.c(),c.m(e,null)))},d(d){d&&H(e),c.d(),t=!1,o()}}}function se(l){let e,t,o,r,s,c,d,m,h,w,u,i,y,f,v,R,I,M,x,j,Y,D,N,q,E,T,k,z,ot,st,O=l[0]&&kt(),F=l[9]&&vt(l);return{c(){e=p("div"),t=p("div"),o=p("form"),r=p("div"),s=p("label"),c=p("input"),d=C(),m=p("div"),h=p("div"),O&&O.c(),u=C(),i=p("span"),i.textContent="Ask about this page",y=C(),f=p("div"),f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="tlwd-w-3 tlwd-h-3 tlwd-text-gray-500 hover:tlwd-text-gray-400 tlwd-transition-colors tlwd-duration-200" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z"></path></svg>',v=C(),R=p("div"),I=p("div"),I.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"></path></svg>`,M=C(),x=p("input"),Y=C(),D=p("div"),N=p("div"),N.textContent="Press ⌘Space+Shift to toggle",q=C(),E=p("button"),E.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-3"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 14.5M14.25 3.104c.251.023.501.05.75.082M19.8 14.5l-7.058 7.058a2.25 2.25 0 01-1.591.659H8.25a2.25 2.25 0 01-2.25-2.25V16.06a2.25 2.25 0 01.659-1.591L13.717 7.41a2.25 2.25 0 011.591-.659h2.892a2.25 2.25 0 012.25 2.25v2.892c0 .597-.237 1.17-.659 1.591z"></path></svg>`,T=C(),k=p("button"),k.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-3"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"></path></svg>`,z=C(),F&&F.c(),n(c,"id","context-toggle"),n(c,"type","checkbox"),n(c,"class","tlwd-sr-only tlwd-focus:tlwd-ring-2 tlwd-focus:tlwd-ring-blue-500"),n(c,"aria-describedby","context-toggle-description"),n(c,"aria-label","Include current page content in your question"),n(h,"class",w="tlwd-w-4 tlwd-h-4 tlwd-rounded tlwd-border tlwd-transition-all tlwd-duration-200 "+(l[0]?"tlwd-bg-blue-500 tlwd-border-blue-500 tlwd-shadow-sm":"tlwd-border-gray-400 tlwd-bg-transparent hover:tlwd-border-gray-300")),n(m,"class","tlwd-relative tlwd-transition-colors tlwd-duration-200"),n(i,"class","tlwd-text-neutral-300 tlwd-select-none tlwd-transition-colors tlwd-duration-200 hover:tlwd-text-neutral-200"),n(f,"class","tlwd-flex tlwd-items-center tlwd-ml-1"),n(f,"id","context-toggle-description"),n(f,"role","tooltip"),n(f,"aria-label","When enabled, your question will include the current page's content as context for more relevant answers"),n(s,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-cursor-pointer tlwd-text-sm tlwd-focus-within:tlwd-outline tlwd-focus-within:tlwd-outline-2 tlwd-focus-within:tlwd-outline-blue-500 tlwd-focus-within:tlwd-outline-offset-2 tlwd-rounded"),n(s,"for","context-toggle"),n(r,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full tlwd-mb-3"),n(I,"class","tlwd-flex tlwd-items-center"),n(x,"id","open-webui-search-input"),n(x,"placeholder",j=l[0]?"Ask about this page...":"Search Open WebUI"),n(x,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),n(x,"autocomplete","one-time-code"),n(R,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full"),n(N,"class","tlwd-text-right tlwd-text-[0.7rem] tlwd-p-0 tlwd-m-0 tlwd-text-neutral-300 tlwd-h-fit"),n(E,"class","tlwd-h-fit tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-yellow-400 tlwd-cursor-pointer tlwd-p-0 tlwd-m-0 tlwd-outline-none tlwd-border-none tlwd-mr-1"),n(E,"type","button"),n(E,"title","Test Content Extraction"),n(k,"class","tlwd-h-fit tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-p-0 tlwd-m-0 tlwd-outline-none tlwd-border-none"),n(k,"type","button"),n(D,"class","tlwd-flex tlwd-justify-end tlwd-gap-1 tlwd-items-center"),n(o,"class","tlwd-text-gray-200 tlwd-w-full tlwd-p-0 tlwd-m-0"),n(o,"autocomplete","off"),n(t,"class","tlwd-w-full tlwd-flex tlwd-flex-col tlwd-justify-between tlwd-py-2.5 tlwd-px-3.5 tlwd-rounded-2xl tlwd-outline tlwd-outline-1 tlwd-outline-gray-850 tlwd-backdrop-blur-3xl tlwd-bg-gray-850/70 shadow-4xl modal-animation"),n(e,"class","tlwd-m-auto tlwd-max-w-xl tlwd-w-full tlwd-pb-32")},m(B,K){U(B,e,K),a(e,t),a(t,o),a(o,r),a(r,s),a(s,c),c.checked=l[0],a(s,d),a(s,m),a(m,h),O&&O.m(h,null),a(s,u),a(s,i),a(s,y),a(s,f),a(o,v),a(o,R),a(R,I),a(R,M),a(R,x),V(x,l[5]),a(o,Y),a(o,D),a(D,N),a(D,q),a(D,E),a(D,T),a(D,k),a(t,z),F&&F.m(t,null),ot||(st=[P(c,"change",l[24]),P(c,"click",fe),P(c,"keydown",l[25]),P(x,"input",l[26]),P(E,"click",l[18]),P(k,"click",l[27]),P(o,"submit",l[13]),P(o,"mousedown",me)],ot=!0)},p(B,K){K[0]&1&&(c.checked=B[0]),B[0]?O||(O=kt(),O.c(),O.m(h,null)):O&&(O.d(1),O=null),K[0]&1&&w!==(w="tlwd-w-4 tlwd-h-4 tlwd-rounded tlwd-border tlwd-transition-all tlwd-duration-200 "+(B[0]?"tlwd-bg-blue-500 tlwd-border-blue-500 tlwd-shadow-sm":"tlwd-border-gray-400 tlwd-bg-transparent hover:tlwd-border-gray-300"))&&n(h,"class",w),K[0]&1&&j!==(j=B[0]?"Ask about this page...":"Search Open WebUI")&&n(x,"placeholder",j),K[0]&32&&x.value!==B[5]&&V(x,B[5]),B[9]?F?F.p(B,K):(F=vt(B),F.c(),F.m(t,null)):F&&(F.d(1),F=null)},d(B){B&&H(e),O&&O.d(),F&&F.d(),ot=!1,G(st)}}}function de(l){let e,t,o,r,s,c,d,m,h,w,u,i,y,f,v,R,I,M=l[6]&&l[6].length>0&&Et(l);return{c(){e=p("div"),t=p("div"),o=p("form"),r=p("div"),s=p("div"),s.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"></path></svg>`,c=C(),d=p("input"),m=C(),h=p("div"),w=p("div"),w.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z"></path></svg>`,u=C(),i=p("input"),y=C(),f=p("button"),f.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"></path></svg>`,v=C(),M&&M.c(),n(s,"class","tlwd-flex tlwd-items-center"),n(d,"id","open-webui-url-input"),n(d,"placeholder","Open WebUI URL"),n(d,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),n(d,"autocomplete","one-time-code"),d.required=!0,n(r,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full"),n(w,"class","tlwd-flex tlwd-items-center"),n(i,"placeholder","Open WebUI API Key"),n(i,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),n(i,"autocomplete","one-time-code"),i.required=!0,n(f,"class","tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-p-0 tlwd-m-0 tlwd-outline-none tlwd-border-none"),n(f,"type","button"),n(h,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full tlwd-mt-2"),n(o,"class","tlwd-text-gray-200 tlwd-w-full tlwd-p-0 tlwd-m-0"),n(o,"autocomplete","off"),n(t,"class","tlwd-w-full tlwd-flex tlwd-flex-col tlwd-justify-between tlwd-py-2.5 tlwd-px-3.5 tlwd-rounded-2xl tlwd-outline tlwd-outline-1 tlwd-outline-gray-850 tlwd-backdrop-blur-3xl tlwd-bg-gray-850/70 shadow-4xl modal-animation"),n(e,"class","tlwd-m-auto tlwd-max-w-sm tlwd-w-full tlwd-pb-32")},m(x,j){U(x,e,j),a(e,t),a(t,o),a(o,r),a(r,s),a(r,c),a(r,d),V(d,l[3]),a(o,m),a(o,h),a(h,w),a(h,u),a(h,i),V(i,l[4]),a(h,y),a(h,f),a(o,v),M&&M.m(o,null),R||(I=[P(d,"input",l[20]),P(i,"input",l[21]),P(f,"click",l[22]),P(o,"submit",l[19]),P(o,"mousedown",we)],R=!0)},p(x,j){j[0]&8&&d.value!==x[3]&&V(d,x[3]),j[0]&16&&i.value!==x[4]&&V(i,x[4]),x[6]&&x[6].length>0?M?M.p(x,j):(M=Et(x),M.c(),M.m(o,null)):M&&(M.d(1),M=null)},d(x){x&&H(e),M&&M.d(),R=!1,G(I)}}}function kt(l){let e,t;return{c(){e=Z("svg"),t=Z("path"),n(t,"stroke-linecap","round"),n(t,"stroke-linejoin","round"),n(t,"d","m4.5 12.75 6 6 9-13.5"),n(e,"xmlns","http://www.w3.org/2000/svg"),n(e,"fill","none"),n(e,"viewBox","0 0 24 24"),n(e,"stroke-width",3),n(e,"stroke","currentColor"),n(e,"class","tlwd-w-3 tlwd-h-3 tlwd-text-white tlwd-absolute tlwd-top-0.5 tlwd-left-0.5 tlwd-transition-opacity tlwd-duration-200"),n(e,"role","img"),n(e,"aria-hidden","true")},m(o,r){U(o,e,r),a(e,t)},d(o){o&&H(e)}}}function vt(l){let e,t,o,r,s,c,d,m=l[7]?"AI is responding...":"Response complete",h,w,u,i,y,f,v,R,I,M,x,j,Y,D;function N(k,z){return k[8]?ce:k[7]?ae:ie}let q=N(l),E=q(l),T=l[11]&&l[10]&&Ct(l);return{c(){e=p("div"),t=p("div"),o=p("div"),r=p("div"),c=C(),d=p("span"),h=lt(m),w=C(),u=p("div"),i=p("button"),y=Z("svg"),f=Z("path"),R=C(),I=p("button"),I.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="tlwd-w-4 tlwd-h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>',M=C(),x=p("div"),E.c(),j=C(),T&&T.c(),n(r,"class",s="tlwd-w-2 tlwd-h-2 tlwd-rounded-full "+(l[7]?"tlwd-bg-blue-500 tlwd-animate-pulse":"tlwd-bg-green-500")),n(d,"class","tlwd-text-sm tlwd-text-gray-300"),n(o,"class","tlwd-flex tlwd-items-center tlwd-gap-2"),n(f,"stroke-linecap","round"),n(f,"stroke-linejoin","round"),n(f,"d","M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"),n(y,"xmlns","http://www.w3.org/2000/svg"),n(y,"fill","none"),n(y,"viewBox","0 0 24 24"),n(y,"stroke-width",2),n(y,"stroke","currentColor"),n(y,"class","tlwd-w-4 tlwd-h-4"),n(i,"class","tlwd-p-1 tlwd-rounded tlwd-bg-transparent hover:tlwd-bg-gray-700 tlwd-text-gray-400 hover:tlwd-text-gray-200 tlwd-transition-colors tlwd-duration-200"),n(i,"type","button"),n(i,"title","Copy response"),i.disabled=v=!l[8],n(I,"class","tlwd-p-1 tlwd-rounded tlwd-bg-transparent hover:tlwd-bg-gray-700 tlwd-text-gray-400 hover:tlwd-text-gray-200 tlwd-transition-colors tlwd-duration-200"),n(I,"type","button"),n(I,"title","Clear response"),n(u,"class","tlwd-flex tlwd-items-center tlwd-gap-2"),n(t,"class","tlwd-flex tlwd-items-center tlwd-justify-between tlwd-mb-3"),n(x,"class","tlwd-max-h-96 tlwd-overflow-y-auto tlwd-text-sm tlwd-leading-relaxed"),n(e,"class","tlwd-mt-4 tlwd-p-4 tlwd-rounded-xl tlwd-bg-gray-800/50 tlwd-backdrop-blur-sm tlwd-border tlwd-border-gray-700")},m(k,z){U(k,e,z),a(e,t),a(t,o),a(o,r),a(o,c),a(o,d),a(d,h),a(t,w),a(t,u),a(u,i),a(i,y),a(y,f),a(u,R),a(u,I),a(e,M),a(e,x),E.m(x,null),a(e,j),T&&T.m(e,null),Y||(D=[P(i,"click",l[28]),P(I,"click",l[29])],Y=!0)},p(k,z){z[0]&128&&s!==(s="tlwd-w-2 tlwd-h-2 tlwd-rounded-full "+(k[7]?"tlwd-bg-blue-500 tlwd-animate-pulse":"tlwd-bg-green-500"))&&n(r,"class",s),z[0]&128&&m!==(m=k[7]?"AI is responding...":"Response complete")&&At(h,m),z[0]&256&&v!==(v=!k[8])&&(i.disabled=v),q===(q=N(k))&&E?E.p(k,z):(E.d(1),E=q(k),E&&(E.c(),E.m(x,null))),k[11]&&k[10]?T?T.p(k,z):(T=Ct(k),T.c(),T.m(e,null)):T&&(T.d(1),T=null)},d(k){k&&H(e),E.d(),T&&T.d(),Y=!1,G(D)}}}function ie(l){let e;return{c(){e=p("div"),e.textContent="No response yet",n(e,"class","tlwd-text-gray-500")},m(t,o){U(t,e,o)},p:Q,d(t){t&&H(e)}}}function ae(l){let e;return{c(){e=p("div"),e.innerHTML=`<div class="tlwd-animate-spin tlwd-w-4 tlwd-h-4 tlwd-border-2 tlwd-border-gray-600 tlwd-border-t-blue-500 tlwd-rounded-full"></div>
                    Waiting for response...`,n(e,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-text-gray-400")},m(t,o){U(t,e,o)},p:Q,d(t){t&&H(e)}}}function ce(l){let e,t=l[17](l[8])+"";return{c(){e=p("div"),n(e,"class","markdown-content")},m(o,r){U(o,e,r),e.innerHTML=t},p(o,r){r[0]&256&&t!==(t=o[17](o[8])+"")&&(e.innerHTML=t)},d(o){o&&H(e)}}}function Ct(l){let e,t,o,r,s,c,d,m,h,w=l[10].canRetry&&Mt(l),u=l[10].canRetryWithoutContext&&St(l);return{c(){e=p("div"),t=p("div"),t.textContent="Error Recovery Options",o=C(),r=p("div"),w&&w.c(),s=C(),u&&u.c(),c=C(),d=p("button"),d.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="tlwd-w-3 tlwd-h-3"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"></path></svg>
                      Open in New Tab`,n(t,"class","tlwd-text-xs tlwd-text-gray-400 tlwd-mb-3"),n(d,"class","tlwd-px-3 tlwd-py-1.5 tlwd-text-xs tlwd-bg-gray-600 hover:tlwd-bg-gray-700 tlwd-text-white tlwd-rounded tlwd-transition-colors tlwd-duration-200 tlwd-flex tlwd-items-center tlwd-gap-1"),n(d,"type","button"),n(r,"class","tlwd-flex tlwd-flex-wrap tlwd-gap-2"),n(e,"class","tlwd-mt-4 tlwd-pt-4 tlwd-border-t tlwd-border-gray-600")},m(i,y){U(i,e,y),a(e,t),a(e,o),a(e,r),w&&w.m(r,null),a(r,s),u&&u.m(r,null),a(r,c),a(r,d),m||(h=P(d,"click",l[16]),m=!0)},p(i,y){i[10].canRetry?w?w.p(i,y):(w=Mt(i),w.c(),w.m(r,s)):w&&(w.d(1),w=null),i[10].canRetryWithoutContext?u?u.p(i,y):(u=St(i),u.c(),u.m(r,c)):u&&(u.d(1),u=null)},d(i){i&&H(e),w&&w.d(),u&&u.d(),m=!1,h()}}}function Mt(l){let e,t,o,r,s,c;return{c(){e=p("button"),t=Z("svg"),o=Z("path"),r=lt(`
                        Retry with Context`),n(o,"stroke-linecap","round"),n(o,"stroke-linejoin","round"),n(o,"d","M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"),n(t,"xmlns","http://www.w3.org/2000/svg"),n(t,"fill","none"),n(t,"viewBox","0 0 24 24"),n(t,"stroke-width",2),n(t,"stroke","currentColor"),n(t,"class","tlwd-w-3 tlwd-h-3"),n(e,"class","tlwd-px-3 tlwd-py-1.5 tlwd-text-xs tlwd-bg-blue-600 hover:tlwd-bg-blue-700 tlwd-text-white tlwd-rounded tlwd-transition-colors tlwd-duration-200 tlwd-flex tlwd-items-center tlwd-gap-1"),n(e,"type","button"),e.disabled=l[7]},m(d,m){U(d,e,m),a(e,t),a(t,o),a(e,r),s||(c=P(e,"click",l[14]),s=!0)},p(d,m){m[0]&128&&(e.disabled=d[7])},d(d){d&&H(e),s=!1,c()}}}function St(l){let e,t,o,r,s,c;return{c(){e=p("button"),t=Z("svg"),o=Z("path"),r=lt(`
                        Retry without Context`),n(o,"stroke-linecap","round"),n(o,"stroke-linejoin","round"),n(o,"d","M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"),n(t,"xmlns","http://www.w3.org/2000/svg"),n(t,"fill","none"),n(t,"viewBox","0 0 24 24"),n(t,"stroke-width",2),n(t,"stroke","currentColor"),n(t,"class","tlwd-w-3 tlwd-h-3"),n(e,"class","tlwd-px-3 tlwd-py-1.5 tlwd-text-xs tlwd-bg-orange-600 hover:tlwd-bg-orange-700 tlwd-text-white tlwd-rounded tlwd-transition-colors tlwd-duration-200 tlwd-flex tlwd-items-center tlwd-gap-1"),n(e,"type","button"),e.disabled=l[7]},m(d,m){U(d,e,m),a(e,t),a(t,o),a(e,r),s||(c=P(e,"click",l[15]),s=!0)},p(d,m){m[0]&128&&(e.disabled=d[7])},d(d){d&&H(e),s=!1,c()}}}function Et(l){let e,t,o,r,s,c,d,m,h,w=ht(l[6]),u=[];for(let i=0;i<w.length;i+=1)u[i]=Lt(xt(l,w,i));return{c(){e=p("div"),t=p("div"),t.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"></path></svg>`,o=C(),r=p("select"),s=p("option"),s.textContent="Select a model";for(let i=0;i<u.length;i+=1)u[i].c();c=C(),d=p("button"),d.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5"></path></svg>`,n(t,"class","tlwd-flex tlwd-items-center"),s.__value="",V(s,s.__value),n(r,"id","open-webui-model-input"),n(r,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),n(r,"autocomplete","off"),r.required=!0,l[12]===void 0&&it(()=>l[23].call(r)),n(d,"class","tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-p-0 tlwd-m-0 tlwd-outline-none tlwd-border-none"),n(d,"type","submit"),n(e,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full tlwd-mt-2")},m(i,y){U(i,e,y),a(e,t),a(e,o),a(e,r),a(r,s);for(let f=0;f<u.length;f+=1)u[f]&&u[f].m(r,null);mt(r,l[12],!0),a(e,c),a(e,d),m||(h=P(r,"change",l[23]),m=!0)},p(i,y){if(y[0]&64){w=ht(i[6]);let f;for(f=0;f<w.length;f+=1){const v=xt(i,w,f);u[f]?u[f].p(v,y):(u[f]=Lt(v),u[f].c(),u[f].m(r,null))}for(;f<u.length;f+=1)u[f].d(1);u.length=w.length}y[0]&4160&&mt(r,i[12])},d(i){i&&H(e),Kt(u,i),m=!1,h()}}}function Lt(l){let e,t=(l[12].name??l[12].id)+"",o,r;return{c(){e=p("option"),o=lt(t),e.__value=r=l[12].id,V(e,e.__value)},m(s,c){U(s,e,c),a(e,o)},p(s,c){c[0]&64&&t!==(t=(s[12].name??s[12].id)+"")&&At(o,t),c[0]&64&&r!==(r=s[12].id)&&(e.__value=r,V(e,e.__value))},d(s){s&&H(e)}}}function ue(l){let e,t=l[1]&&_t(l);return{c(){t&&t.c(),e=Vt()},m(o,r){t&&t.m(o,r),U(o,e,r)},p(o,r){o[1]?t?t.p(o,r):(t=_t(o),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Q,o:Q,d(o){o&&H(e),t&&t.d(o)}}}const we=l=>{l.stopPropagation()},fe=l=>l.stopPropagation(),me=l=>{l.stopPropagation()};function ge(l,e,t){let o=!1,r=!0,s="",c="",d="",m="",h=[],w=!0,u=!1,i="",y=!1,f=null,v=!1;const R=()=>{console.log("resetConfig");try{chrome.storage.local.clear().then(()=>{console.log("Value is cleared")})}catch(b){console.log(b),localStorage.setItem("url",""),localStorage.setItem("key",""),localStorage.setItem("model",""),localStorage.setItem("includePageContext","true")}t(3,s=""),t(4,c=""),t(12,d=""),t(6,h=[]),t(0,w=!0),t(2,r=!0),t(9,y=!1),t(8,i=""),t(7,u=!1),t(10,f=null),t(11,v=!1)},I=async b=>{var _,A;if(b.preventDefault(),!!m.trim()){if(!w){const g=`${s}/?q=${encodeURIComponent(m)}&models=${d}&web-search=true`;console.log("🔗 Opening Open WebUI in new tab with web search enabled:",{url:s,searchValue:m,model:d,fullURL:g}),window.open(g,"_blank"),t(5,m=""),t(1,o=!1);return}try{t(7,u=!0),t(9,y=!0),t(8,i=""),t(10,f=null),t(11,v=!1);let g=null,J=!1;try{console.log("📄 Extracting page content..."),g=await Promise.race([yt(),new Promise((L,W)=>setTimeout(()=>W(new Error("Content extraction timeout")),1e4))]),console.log("✅ Page content extracted successfully")}catch(L){console.warn("⚠️ Content extraction failed:",L),J=!0,t(10,f={type:"content_extraction",message:"Unable to extract page content",details:L.message,canRetryWithoutContext:!0}),t(8,i=`Unable to extract page content: ${L.message}

You can try again without page context, or retry with context.`),t(7,u=!1),t(11,v=!0);return}const X=M(m,g);console.log("🚀 Starting context-aware completion:",{userQuery:m,hasContext:!!g,contextLength:((_=g==null?void 0:g.mainContent)==null?void 0:_.length)||0});const S=await Promise.race([chrome.runtime.sendMessage({action:"fetchCompletion",url:s,key:c,isOpenAI:((A=h.find(L=>L.id===d))==null?void 0:A.owned_by)==="openai",inlineMode:!1,payload:{model:d,messages:[{role:"system",content:"You are a helpful assistant. When provided with page context, use it to give more relevant and specific answers to the user's questions."},{role:"user",content:X}],stream:!0}}),new Promise((L,W)=>setTimeout(()=>W(new Error("API request timeout")),3e4))]);if(!S.success)throw new Error(S.error)}catch(g){console.error("❌ Context-aware query failed:",g);const J=g.message.includes("timeout")||g.message.includes("network")||g.message.includes("fetch"),X=g.message.includes("API")||g.message.includes("unauthorized")||g.message.includes("400")||g.message.includes("401")||g.message.includes("500");J?(t(10,f={type:"network",message:"Network connection issue",details:g.message,canRetry:!0,canRetryWithoutContext:!0}),t(8,i=`Network Error: ${g.message}

This might be due to:
• Poor internet connection
• Server is temporarily unavailable
• Request timeout

You can retry or try without page context.`)):X?(t(10,f={type:"api",message:"AI service unavailable",details:g.message,canRetry:!0,canRetryWithoutContext:!0}),t(8,i=`API Error: ${g.message}

This might be due to:
• Invalid API key or configuration
• Server maintenance
• Rate limiting

Please check your settings or try again later.`)):(t(10,f={type:"unknown",message:"Unexpected error occurred",details:g.message,canRetry:!0,canRetryWithoutContext:!0}),t(8,i=`Unexpected Error: ${g.message}

Something went wrong. You can try again or use the fallback search.`)),t(7,u=!1),t(11,v=!0),console.error("🐛 Error details:",{type:f.type,message:f.message,details:f.details,timestamp:new Date().toISOString()})}}},M=(b,_)=>{let A="";return _&&(A+=`Context: Page Title: ${_.title||"Untitled"}
`,A+=`URL: ${_.url}
`,_.metaDescription&&(A+=`Description: ${_.metaDescription}
`),_.selectedText&&(A+=`Selected Text: ${_.selectedText}
`),A+=`Content: ${_.mainContent||"No content available"}

`),A+=`User Question: ${b}

`,_&&(A+="Please answer the user's question based on the provided page context. If the context is not relevant to the question, you can provide a general answer but mention that the context may not be directly related."),A},x=async()=>{console.log("🔄 Retrying with context..."),t(10,f=null),t(11,v=!1),await I({preventDefault:()=>{}})},j=async()=>{console.log("🔄 Retrying without context...");const b=w;t(0,w=!1),t(10,f=null),t(11,v=!1);try{await I({preventDefault:()=>{}})}finally{t(0,w=b)}},Y=()=>{console.log("🔄 Falling back to normal search with web search enabled..."),window.open(`${s}/?q=${encodeURIComponent(m)}&models=${d}&web-search=true`,"_blank"),t(5,m=""),t(1,o=!1),t(9,y=!1),t(8,i=""),t(10,f=null),t(11,v=!1)},D=b=>{if(!b)return"";let _=b.replace(/^### (.*$)/gim,'<h3 class="tlwd-text-lg tlwd-font-semibold tlwd-text-gray-100 tlwd-mt-4 tlwd-mb-2">$1</h3>').replace(/^## (.*$)/gim,'<h2 class="tlwd-text-xl tlwd-font-bold tlwd-text-gray-100 tlwd-mt-4 tlwd-mb-2">$1</h2>').replace(/^# (.*$)/gim,'<h1 class="tlwd-text-2xl tlwd-font-bold tlwd-text-gray-100 tlwd-mt-4 tlwd-mb-2">$1</h1>').replace(/\*\*\*(.*?)\*\*\*/g,'<strong class="tlwd-font-bold tlwd-text-gray-100"><em class="tlwd-italic">$1</em></strong>').replace(/\*\*(.*?)\*\*/g,'<strong class="tlwd-font-bold tlwd-text-gray-100">$1</strong>').replace(/\*(.*?)\*/g,'<em class="tlwd-italic tlwd-text-gray-200">$1</em>').replace(/```([^`]+)```/g,'<pre class="tlwd-bg-gray-800 tlwd-rounded tlwd-p-2 tlwd-mt-2 tlwd-mb-2 tlwd-text-xs tlwd-font-mono tlwd-text-gray-300 tlwd-overflow-x-auto"><code>$1</code></pre>').replace(/`([^`]+)`/g,'<code class="tlwd-bg-gray-800 tlwd-px-1 tlwd-rounded tlwd-text-xs tlwd-font-mono tlwd-text-gray-300">$1</code>').replace(/^\* (.*$)/gim,'<li class="tlwd-ml-4 tlwd-list-disc tlwd-text-gray-200 tlwd-mb-1">$1</li>').replace(/^- (.*$)/gim,'<li class="tlwd-ml-4 tlwd-list-disc tlwd-text-gray-200 tlwd-mb-1">$1</li>').replace(/^\d+\. (.*$)/gim,'<li class="tlwd-ml-4 tlwd-list-decimal tlwd-text-gray-200 tlwd-mb-1">$1</li>').replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" class="tlwd-text-blue-400 hover:tlwd-text-blue-300 tlwd-underline" target="_blank" rel="noopener noreferrer">$1</a>').replace(/\n\n/g,'</p><p class="tlwd-text-gray-200 tlwd-mb-2">').replace(/\n/g,"<br>");return _.trim()&&(_='<p class="tlwd-text-gray-200 tlwd-mb-2">'+_+"</p>"),_=_.replace(/(<li[^>]*class="[^"]*list-disc[^"]*"[^>]*>.*?<\/li>)+/g,'<ul class="tlwd-mb-2">$&</ul>'),_=_.replace(/(<li[^>]*class="[^"]*list-decimal[^"]*"[^>]*>.*?<\/li>)+/g,'<ol class="tlwd-mb-2">$&</ol>'),_},N=async()=>{try{console.log("🧪 Testing content extraction and context-aware prompt..."),console.log("📋 Toggle State:",{includePageContext:w,placeholder:w?"Ask about this page...":"Search Open WebUI"});const b=await yt();console.log("✅ Content extracted successfully:",b);const A=M("What is this page about?",b);console.log("📝 Context-aware prompt created:",A),console.log("📊 Content Summary:",{title:b.title,domain:b.domain,contentLength:b.contentLength,hasMetaDescription:!!b.metaDescription,hasSelectedText:!!b.selectedText,timestamp:b.timestamp,promptLength:A.length}),alert(`Content extraction & prompt creation successful!

Toggle State: ${w?"Enabled":"Disabled"}
Title: ${b.title}
Domain: ${b.domain}
Content Length: ${b.contentLength} chars
Prompt Length: ${A.length} chars

Check console for full details including the generated prompt.`)}catch(b){console.error("❌ Content extraction failed:",b),alert(`Content extraction failed: ${b.message}`)}},q=b=>{b.preventDefault();try{chrome.storage.local.set({url:s,key:c,model:d,includePageContext:w}).then(()=>{console.log("Value is set")})}catch(_){console.log(_),localStorage.setItem("url",s),localStorage.setItem("key",c),localStorage.setItem("model",d),localStorage.setItem("includePageContext",w.toString())}t(2,r=!1)};Gt(async()=>{let b=null;try{b=await chrome.storage.local.get()}catch(g){console.log(g)}const _=g=>{g.action==="contextStreamChunk"?t(8,i+=g.text):g.action==="contextStreamComplete"&&(console.log("🏁 Context-aware stream completed"),t(7,u=!1))};try{chrome.runtime.onMessage.addListener(_)}catch(g){console.log("Failed to add message listener:",g)}b&&(t(3,s=b.url??""),t(4,c=b.key??""),t(12,d=b.model??""),t(0,w=b.includePageContext??!0),b.url&&b.key&&b.model&&(t(6,h=await bt(b.key,b.url).catch(g=>{console.log(g),R()})),h&&t(2,r=!1)));const A=async g=>{var J,X;if(o&&g.shiftKey&&g.key==="Escape"?R():g.key==="Escape"&&(y||v?(t(9,y=!1),t(8,i=""),t(7,u=!1),t(10,f=null),t(11,v=!1)):t(1,o=!1)),g.key===" "&&(g.metaKey||g.ctrlKey)&&(g.shiftKey||g.altKey)){console.log("🔧 Search shortcut triggered"),g.preventDefault();try{const S=await chrome.runtime.sendMessage({action:"getSelection"});((S==null?void 0:S.data)??!1)&&t(5,m=S.data)}catch(S){console.log("catch",S)}t(1,o=!o),setTimeout(()=>{const S=document.getElementById("open-webui-search-input");S&&S.focus()},0)}if(c!==""&&s!==""&&g.key==="Enter"&&(g.metaKey||g.ctrlKey)&&(g.shiftKey||g.altKey)){g.preventDefault();try{console.log("🔧 Direct completion triggered");const S=await chrome.runtime.sendMessage({action:"getSelection"});if(console.log("📝 Selected text:",S==null?void 0:S.data),(S==null?void 0:S.data)??!1){console.log("✅ Text selected, starting AI completion"),await chrome.runtime.sendMessage({action:"writeText",text:`
`}),console.log("🌐 Using background script for API call");const L=await chrome.runtime.sendMessage({action:"fetchCompletion",url:s,key:c,isOpenAI:((J=h.find(W=>W.id===d))==null?void 0:J.owned_by)==="openai",inlineMode:!0,payload:{model:d,messages:[{role:"system",content:"You are a helpful assistant."},{role:"user",content:S.data}],stream:!0}});L.success?console.log("🚀 Background streaming started"):(console.error("❌ Background request failed:",L.error),await chrome.runtime.sendMessage({action:"writeText",text:`Error: ${L.error}`}))}else{console.log("⚠️ No text selected, extracting page content for summarization");try{const L=await chrome.runtime.sendMessage({action:"getPageContent"});if(L.success&&L.data){const W=L.data;console.log("📄 Page content extracted for summarization");const Dt=`Page Title: ${W.title||"Untitled"}
URL: ${W.url}
${W.metaDescription?`Description: ${W.metaDescription}
`:""}
Content: ${W.mainContent||"No content available"}`;t(1,o=!0),t(9,y=!0),t(8,i=""),t(7,u=!0),t(5,m="Summarizing page content...");const at=await chrome.runtime.sendMessage({action:"fetchCompletion",url:s,key:c,isOpenAI:((X=h.find(zt=>zt.id===d))==null?void 0:X.owned_by)==="openai",inlineMode:!1,payload:{model:d,messages:[{role:"system",content:"Task: Summarize the following article. Length: 5-7 sentences. Format: Markdown. Requirements: capture the main ideas and key points; easy to understand; summary should be free from ambiguity."},{role:"user",content:Dt}],stream:!0}});at.success?console.log("🚀 Page summarization started"):(console.error("❌ Page summarization failed:",at.error),t(8,i=`Error: ${at.error}`),t(7,u=!1))}else console.error("❌ Failed to extract page content:",L.error),t(1,o=!0),t(9,y=!0),t(8,i=`Error extracting page content: ${L.error||"Unknown error"}`),t(7,u=!1)}catch(L){console.error("💥 Page content extraction error:",L),t(1,o=!0),t(9,y=!0),t(8,i=`Error extracting page content: ${L.message}`),t(7,u=!1)}}}catch(S){console.error("💥 Completion error:",S),t(1,o=!0),t(9,y=!0),t(8,i=`Error: ${S.message}`),t(7,u=!1)}}};return document.addEventListener("keydown",A,{capture:!0}),()=>{document.removeEventListener("keydown",A);try{chrome.runtime.onMessage.removeListener(_)}catch(g){console.log("Failed to remove message listener:",g)}}});function E(){s=this.value,t(3,s)}function T(){c=this.value,t(4,c)}const k=async()=>{s.endsWith("/")&&t(3,s=s.slice(0,-1)),t(6,h=await bt(c,s))};function z(){d=Qt(this),t(12,d),t(6,h)}function ot(){w=this.checked,t(0,w)}const st=b=>{b.key===" "&&(b.preventDefault(),b.stopPropagation(),t(0,w=!w))};function O(){m=this.value,t(5,m)}const F=()=>{t(2,r=!0)},B=()=>{navigator.clipboard.writeText(i)},K=()=>{t(9,y=!1),t(8,i=""),t(5,m=""),t(10,f=null),t(11,v=!1)},Ut=()=>{t(1,o=!1)};return l.$$.update=()=>{if(l.$$.dirty[0]&1&&typeof w<"u")try{chrome.storage.local.set({includePageContext:w})}catch{localStorage.setItem("includePageContext",w.toString())}},[w,o,r,s,c,m,h,u,i,y,f,v,d,I,x,j,Y,D,N,q,E,T,k,z,ot,st,O,F,B,K,Ut]}class pe extends Bt{constructor(e){super(),Ot(this,e,ge,ue,Tt,{},null,[-1,-1])}}function he(l){let e,t,o;return t=new pe({}),{c(){e=p("div"),oe(t.$$.fragment),n(e,"class","extension-container")},m(r,s){U(r,e,s),Ht(t,e,null),o=!0},p:Q,i(r){o||(Ft(t.$$.fragment,r),o=!0)},o(r){le(t.$$.fragment,r),o=!1},d(r){r&&H(e),jt(t)}}}class be extends Bt{constructor(e){super(),Ot(this,e,null,he,Tt,{})}}new be({target:document.getElementById("extension-app")});
