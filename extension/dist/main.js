var We=Object.defineProperty;var ze=(l,t,e)=>t in l?We(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var ce=(l,t,e)=>(ze(l,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}})();function Q(){}function Ie(l){return l()}function me(){return Object.create(null)}function G(l){l.forEach(Ie)}function Te(l){return typeof l=="function"}function Ae(l,t){return l!=l?t==t:l!==t||l&&typeof l=="object"||typeof l=="function"}function Ne(l){return Object.keys(l).length===0}function d(l,t){l.appendChild(t)}function D(l,t,e){l.insertBefore(t,e||null)}function j(l){l.parentNode&&l.parentNode.removeChild(l)}function qe(l,t){for(let e=0;e<l.length;e+=1)l[e]&&l[e].d(t)}function h(l){return document.createElement(l)}function Z(l){return document.createElementNS("http://www.w3.org/2000/svg",l)}function J(l){return document.createTextNode(l)}function k(){return J(" ")}function Ke(){return J("")}function P(l,t,e,n){return l.addEventListener(t,e,n),()=>l.removeEventListener(t,e,n)}function o(l,t,e){e==null?l.removeAttribute(t):l.getAttribute(t)!==e&&l.setAttribute(t,e)}function Ve(l){return Array.from(l.childNodes)}function fe(l,t){t=""+t,l.data!==t&&(l.data=t)}function V(l,t){l.value=t??""}function pe(l,t,e){for(let n=0;n<l.options.length;n+=1){const r=l.options[n];if(r.__value===t){r.selected=!0;return}}(!e||t!==void 0)&&(l.selectedIndex=-1)}function Ye(l){const t=l.querySelector(":checked");return t&&t.__value}let re;function oe(l){re=l}function Qe(){if(!re)throw new Error("Function called outside component initialization");return re}function Ze(l){Qe().$$.on_mount.push(l)}const te=[],ge=[];let le=[];const he=[],Ge=Promise.resolve();let we=!1;function Je(){we||(we=!0,Ge.then(Re))}function de(l){le.push(l)}const ue=new Set;let ee=0;function Re(){if(ee!==0)return;const l=re;do{try{for(;ee<te.length;){const t=te[ee];ee++,oe(t),Xe(t.$$)}}catch(t){throw te.length=0,ee=0,t}for(oe(null),te.length=0,ee=0;ge.length;)ge.pop()();for(let t=0;t<le.length;t+=1){const e=le[t];ue.has(e)||(ue.add(e),e())}le.length=0}while(te.length);for(;he.length;)he.pop()();we=!1,ue.clear(),oe(l)}function Xe(l){if(l.fragment!==null){l.update(),G(l.before_update);const t=l.dirty;l.dirty=[-1],l.fragment&&l.fragment.p(l.ctx,t),l.after_update.forEach(de)}}function $e(l){const t=[],e=[];le.forEach(n=>l.indexOf(n)===-1?t.push(n):e.push(n)),e.forEach(n=>n()),le=t}const ie=new Set;let et;function Fe(l,t){l&&l.i&&(ie.delete(l),l.i(t))}function tt(l,t,e,n){if(l&&l.o){if(ie.has(l))return;ie.add(l),et.c.push(()=>{ie.delete(l)}),l.o(t)}}function be(l){return(l==null?void 0:l.length)!==void 0?l:Array.from(l)}function lt(l){l&&l.c()}function je(l,t,e){const{fragment:n,after_update:r}=l.$$;n&&n.m(t,e),de(()=>{const s=l.$$.on_mount.map(Ie).filter(Te);l.$$.on_destroy?l.$$.on_destroy.push(...s):G(s),l.$$.on_mount=[]}),r.forEach(de)}function Oe(l,t){const e=l.$$;e.fragment!==null&&($e(e.after_update),G(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function nt(l,t){l.$$.dirty[0]===-1&&(te.push(l),Je(),l.$$.dirty.fill(0)),l.$$.dirty[t/31|0]|=1<<t%31}function Be(l,t,e,n,r,s,a=null,i=[-1]){const m=re;oe(l);const g=l.$$={fragment:null,ctx:[],props:s,update:Q,not_equal:r,bound:me(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(m?m.$$.context:[])),callbacks:me(),dirty:i,skip_bound:!1,root:t.target||m.$$.root};a&&a(g.root);let w=!1;if(g.ctx=e?e(l,t.props||{},(u,c,...y)=>{const f=y.length?y[0]:c;return g.ctx&&r(g.ctx[u],g.ctx[u]=f)&&(!g.skip_bound&&g.bound[u]&&g.bound[u](f),w&&nt(l,u)),c}):[],g.update(),w=!0,G(g.before_update),g.fragment=n?n(g.ctx):!1,t.target){if(t.hydrate){const u=Ve(t.target);g.fragment&&g.fragment.l(u),u.forEach(j)}else g.fragment&&g.fragment.c();t.intro&&Fe(l.$$.fragment),je(l,t.target,t.anchor),Re()}oe(m)}class Ue{constructor(){ce(this,"$$");ce(this,"$$set")}$destroy(){Oe(this,1),this.$destroy=Q}$on(t,e){if(!Te(e))return Q;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const r=n.indexOf(e);r!==-1&&n.splice(r,1)}}$set(t){this.$$set&&!Ne(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const ot="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ot);const ye=async(l,t)=>{var e;try{if(typeof chrome>"u"||!chrome.runtime)throw new Error("Chrome extension API not available");const n=await chrome.runtime.sendMessage({action:"fetchModels",key:l,url:t});if(!n.success)throw new Error(n.error);let r=((e=n.data)==null?void 0:e.data)??[];return r=r.filter(s=>s).sort((s,a)=>{const i=s.name.toLowerCase(),m=a.name.toLowerCase();return i<m?-1:i>m?1:s<a?-1:s>a?1:0}),console.log(r),r}catch(n){throw console.log(n),n}},_e=async()=>{try{if(typeof chrome>"u"||!chrome.runtime)throw new Error("Chrome extension API not available");const l=await chrome.runtime.sendMessage({action:"getPageContent"});if(!l.success)throw new Error(l.error);return l.data}catch(l){throw console.error("Error getting page content:",l),l}};function xe(l,t,e){const n=l.slice();return n[12]=t[e],n}function ve(l){let t,e,n;function r(i,m){return i[2]?st:rt}let s=r(l),a=s(l);return{c(){t=h("div"),a.c(),o(t,"class","tlwd-fixed tlwd-top-0 tlwd-right-0 tlwd-left-0 tlwd-bottom-0 tlwd-w-full tlwd-min-h-screen tlwd-h-screen tlwd-flex tlwd-justify-center tlwd-z-[9999999999] tlwd-overflow-hidden tlwd-overscroll-contain")},m(i,m){D(i,t,m),a.m(t,null),e||(n=P(t,"mousedown",l[29]),e=!0)},p(i,m){s===(s=r(i))&&a?a.p(i,m):(a.d(1),a=s(i),a&&(a.c(),a.m(t,null)))},d(i){i&&j(t),a.d(),e=!1,n()}}}function rt(l){let t,e,n,r,s,a,i,m,g,w,u,c,y,f,v,R,L,C,_,O,Y,H,N,q,S,I,x,W,ne,se,B=l[0]&&ke(),F=l[9]&&Ce(l);return{c(){t=h("div"),e=h("div"),n=h("form"),r=h("div"),s=h("label"),a=h("input"),i=k(),m=h("div"),g=h("div"),B&&B.c(),u=k(),c=h("span"),c.textContent="Ask about this page",y=k(),f=h("div"),f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="tlwd-w-3 tlwd-h-3 tlwd-text-gray-500 hover:tlwd-text-gray-400 tlwd-transition-colors tlwd-duration-200" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z"></path></svg>',v=k(),R=h("div"),L=h("div"),L.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"></path></svg>`,C=k(),_=h("input"),Y=k(),H=h("div"),N=h("div"),N.textContent="Press ⌘Space+Shift to toggle",q=k(),S=h("button"),S.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-3"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 14.5M14.25 3.104c.251.023.501.05.75.082M19.8 14.5l-7.058 7.058a2.25 2.25 0 01-1.591.659H8.25a2.25 2.25 0 01-2.25-2.25V16.06a2.25 2.25 0 01.659-1.591L13.717 7.41a2.25 2.25 0 011.591-.659h2.892a2.25 2.25 0 012.25 2.25v2.892c0 .597-.237 1.17-.659 1.591z"></path></svg>`,I=k(),x=h("button"),x.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-3"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"></path></svg>`,W=k(),F&&F.c(),o(a,"id","context-toggle"),o(a,"type","checkbox"),o(a,"class","tlwd-sr-only tlwd-focus:tlwd-ring-2 tlwd-focus:tlwd-ring-blue-500"),o(a,"aria-describedby","context-toggle-description"),o(a,"aria-label","Include current page content in your question"),o(g,"class",w="tlwd-w-4 tlwd-h-4 tlwd-rounded tlwd-border tlwd-transition-all tlwd-duration-200 "+(l[0]?"tlwd-bg-blue-500 tlwd-border-blue-500 tlwd-shadow-sm":"tlwd-border-gray-400 tlwd-bg-transparent hover:tlwd-border-gray-300")),o(m,"class","tlwd-relative tlwd-transition-colors tlwd-duration-200"),o(c,"class","tlwd-text-neutral-300 tlwd-select-none tlwd-transition-colors tlwd-duration-200 hover:tlwd-text-neutral-200"),o(f,"class","tlwd-flex tlwd-items-center tlwd-ml-1"),o(f,"id","context-toggle-description"),o(f,"role","tooltip"),o(f,"aria-label","When enabled, your question will include the current page's content as context for more relevant answers"),o(s,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-cursor-pointer tlwd-text-sm tlwd-focus-within:tlwd-outline tlwd-focus-within:tlwd-outline-2 tlwd-focus-within:tlwd-outline-blue-500 tlwd-focus-within:tlwd-outline-offset-2 tlwd-rounded"),o(s,"for","context-toggle"),o(r,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full tlwd-mb-3"),o(L,"class","tlwd-flex tlwd-items-center"),o(_,"id","open-webui-search-input"),o(_,"placeholder",O=l[0]?"Ask about this page...":"Search Open WebUI"),o(_,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),o(_,"autocomplete","one-time-code"),o(R,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full"),o(N,"class","tlwd-text-right tlwd-text-[0.7rem] tlwd-p-0 tlwd-m-0 tlwd-text-neutral-300 tlwd-h-fit"),o(S,"class","tlwd-h-fit tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-yellow-400 tlwd-cursor-pointer tlwd-p-0 tlwd-m-0 tlwd-outline-none tlwd-border-none tlwd-mr-1"),o(S,"type","button"),o(S,"title","Test Content Extraction"),o(x,"class","tlwd-h-fit tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-p-0 tlwd-m-0 tlwd-outline-none tlwd-border-none"),o(x,"type","button"),o(H,"class","tlwd-flex tlwd-justify-end tlwd-gap-1 tlwd-items-center"),o(n,"class","tlwd-text-gray-200 tlwd-w-full tlwd-p-0 tlwd-m-0"),o(n,"autocomplete","off"),o(e,"class","tlwd-w-full tlwd-flex tlwd-flex-col tlwd-justify-between tlwd-py-2.5 tlwd-px-3.5 tlwd-rounded-2xl tlwd-outline tlwd-outline-1 tlwd-outline-gray-850 tlwd-backdrop-blur-3xl tlwd-bg-gray-850/70 shadow-4xl modal-animation"),o(t,"class","tlwd-m-auto tlwd-max-w-xl tlwd-w-full tlwd-pb-32")},m(U,K){D(U,t,K),d(t,e),d(e,n),d(n,r),d(r,s),d(s,a),a.checked=l[0],d(s,i),d(s,m),d(m,g),B&&B.m(g,null),d(s,u),d(s,c),d(s,y),d(s,f),d(n,v),d(n,R),d(R,L),d(R,C),d(R,_),V(_,l[5]),d(n,Y),d(n,H),d(H,N),d(H,q),d(H,S),d(H,I),d(H,x),d(e,W),F&&F.m(e,null),ne||(se=[P(a,"change",l[23]),P(a,"click",wt),P(a,"keydown",l[24]),P(_,"input",l[25]),P(S,"click",l[17]),P(x,"click",l[26]),P(n,"submit",l[13]),P(n,"mousedown",ft)],ne=!0)},p(U,K){K[0]&1&&(a.checked=U[0]),U[0]?B||(B=ke(),B.c(),B.m(g,null)):B&&(B.d(1),B=null),K[0]&1&&w!==(w="tlwd-w-4 tlwd-h-4 tlwd-rounded tlwd-border tlwd-transition-all tlwd-duration-200 "+(U[0]?"tlwd-bg-blue-500 tlwd-border-blue-500 tlwd-shadow-sm":"tlwd-border-gray-400 tlwd-bg-transparent hover:tlwd-border-gray-300"))&&o(g,"class",w),K[0]&1&&O!==(O=U[0]?"Ask about this page...":"Search Open WebUI")&&o(_,"placeholder",O),K[0]&32&&_.value!==U[5]&&V(_,U[5]),U[9]?F?F.p(U,K):(F=Ce(U),F.c(),F.m(e,null)):F&&(F.d(1),F=null)},d(U){U&&j(t),B&&B.d(),F&&F.d(),ne=!1,G(se)}}}function st(l){let t,e,n,r,s,a,i,m,g,w,u,c,y,f,v,R,L,C=l[6]&&l[6].length>0&&Pe(l);return{c(){t=h("div"),e=h("div"),n=h("form"),r=h("div"),s=h("div"),s.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"></path></svg>`,a=k(),i=h("input"),m=k(),g=h("div"),w=h("div"),w.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z"></path></svg>`,u=k(),c=h("input"),y=k(),f=h("button"),f.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"></path></svg>`,v=k(),C&&C.c(),o(s,"class","tlwd-flex tlwd-items-center"),o(i,"id","open-webui-url-input"),o(i,"placeholder","Open WebUI URL"),o(i,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),o(i,"autocomplete","one-time-code"),i.required=!0,o(r,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full"),o(w,"class","tlwd-flex tlwd-items-center"),o(c,"placeholder","Open WebUI API Key"),o(c,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),o(c,"autocomplete","one-time-code"),c.required=!0,o(f,"class","tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-p-0 tlwd-m-0 tlwd-outline-none tlwd-border-none"),o(f,"type","button"),o(g,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full tlwd-mt-2"),o(n,"class","tlwd-text-gray-200 tlwd-w-full tlwd-p-0 tlwd-m-0"),o(n,"autocomplete","off"),o(e,"class","tlwd-w-full tlwd-flex tlwd-flex-col tlwd-justify-between tlwd-py-2.5 tlwd-px-3.5 tlwd-rounded-2xl tlwd-outline tlwd-outline-1 tlwd-outline-gray-850 tlwd-backdrop-blur-3xl tlwd-bg-gray-850/70 shadow-4xl modal-animation"),o(t,"class","tlwd-m-auto tlwd-max-w-sm tlwd-w-full tlwd-pb-32")},m(_,O){D(_,t,O),d(t,e),d(e,n),d(n,r),d(r,s),d(r,a),d(r,i),V(i,l[3]),d(n,m),d(n,g),d(g,w),d(g,u),d(g,c),V(c,l[4]),d(g,y),d(g,f),d(n,v),C&&C.m(n,null),R||(L=[P(i,"input",l[19]),P(c,"input",l[20]),P(f,"click",l[21]),P(n,"submit",l[18]),P(n,"mousedown",ut)],R=!0)},p(_,O){O[0]&8&&i.value!==_[3]&&V(i,_[3]),O[0]&16&&c.value!==_[4]&&V(c,_[4]),_[6]&&_[6].length>0?C?C.p(_,O):(C=Pe(_),C.c(),C.m(n,null)):C&&(C.d(1),C=null)},d(_){_&&j(t),C&&C.d(),R=!1,G(L)}}}function ke(l){let t,e;return{c(){t=Z("svg"),e=Z("path"),o(e,"stroke-linecap","round"),o(e,"stroke-linejoin","round"),o(e,"d","m4.5 12.75 6 6 9-13.5"),o(t,"xmlns","http://www.w3.org/2000/svg"),o(t,"fill","none"),o(t,"viewBox","0 0 24 24"),o(t,"stroke-width",3),o(t,"stroke","currentColor"),o(t,"class","tlwd-w-3 tlwd-h-3 tlwd-text-white tlwd-absolute tlwd-top-0.5 tlwd-left-0.5 tlwd-transition-opacity tlwd-duration-200"),o(t,"role","img"),o(t,"aria-hidden","true")},m(n,r){D(n,t,r),d(t,e)},d(n){n&&j(t)}}}function Ce(l){let t,e,n,r,s,a,i,m=l[7]?"AI is responding...":"Response complete",g,w,u,c,y,f,v,R,L,C,_,O,Y,H;function N(x,W){return x[8]?at:x[7]?dt:it}let q=N(l),S=q(l),I=l[11]&&l[10]&&Me(l);return{c(){t=h("div"),e=h("div"),n=h("div"),r=h("div"),a=k(),i=h("span"),g=J(m),w=k(),u=h("div"),c=h("button"),y=Z("svg"),f=Z("path"),R=k(),L=h("button"),L.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="tlwd-w-4 tlwd-h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>',C=k(),_=h("div"),S.c(),O=k(),I&&I.c(),o(r,"class",s="tlwd-w-2 tlwd-h-2 tlwd-rounded-full "+(l[7]?"tlwd-bg-blue-500 tlwd-animate-pulse":"tlwd-bg-green-500")),o(i,"class","tlwd-text-sm tlwd-text-gray-300"),o(n,"class","tlwd-flex tlwd-items-center tlwd-gap-2"),o(f,"stroke-linecap","round"),o(f,"stroke-linejoin","round"),o(f,"d","M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"),o(y,"xmlns","http://www.w3.org/2000/svg"),o(y,"fill","none"),o(y,"viewBox","0 0 24 24"),o(y,"stroke-width",2),o(y,"stroke","currentColor"),o(y,"class","tlwd-w-4 tlwd-h-4"),o(c,"class","tlwd-p-1 tlwd-rounded tlwd-bg-transparent hover:tlwd-bg-gray-700 tlwd-text-gray-400 hover:tlwd-text-gray-200 tlwd-transition-colors tlwd-duration-200"),o(c,"type","button"),o(c,"title","Copy response"),c.disabled=v=!l[8],o(L,"class","tlwd-p-1 tlwd-rounded tlwd-bg-transparent hover:tlwd-bg-gray-700 tlwd-text-gray-400 hover:tlwd-text-gray-200 tlwd-transition-colors tlwd-duration-200"),o(L,"type","button"),o(L,"title","Clear response"),o(u,"class","tlwd-flex tlwd-items-center tlwd-gap-2"),o(e,"class","tlwd-flex tlwd-items-center tlwd-justify-between tlwd-mb-3"),o(_,"class","tlwd-max-h-96 tlwd-overflow-y-auto tlwd-text-sm tlwd-text-gray-200 tlwd-leading-relaxed tlwd-whitespace-pre-wrap"),o(t,"class","tlwd-mt-4 tlwd-p-4 tlwd-rounded-xl tlwd-bg-gray-800/50 tlwd-backdrop-blur-sm tlwd-border tlwd-border-gray-700")},m(x,W){D(x,t,W),d(t,e),d(e,n),d(n,r),d(n,a),d(n,i),d(i,g),d(e,w),d(e,u),d(u,c),d(c,y),d(y,f),d(u,R),d(u,L),d(t,C),d(t,_),S.m(_,null),d(t,O),I&&I.m(t,null),Y||(H=[P(c,"click",l[27]),P(L,"click",l[28])],Y=!0)},p(x,W){W[0]&128&&s!==(s="tlwd-w-2 tlwd-h-2 tlwd-rounded-full "+(x[7]?"tlwd-bg-blue-500 tlwd-animate-pulse":"tlwd-bg-green-500"))&&o(r,"class",s),W[0]&128&&m!==(m=x[7]?"AI is responding...":"Response complete")&&fe(g,m),W[0]&256&&v!==(v=!x[8])&&(c.disabled=v),q===(q=N(x))&&S?S.p(x,W):(S.d(1),S=q(x),S&&(S.c(),S.m(_,null))),x[11]&&x[10]?I?I.p(x,W):(I=Me(x),I.c(),I.m(t,null)):I&&(I.d(1),I=null)},d(x){x&&j(t),S.d(),I&&I.d(),Y=!1,G(H)}}}function it(l){let t;return{c(){t=h("div"),t.textContent="No response yet",o(t,"class","tlwd-text-gray-500")},m(e,n){D(e,t,n)},p:Q,d(e){e&&j(t)}}}function dt(l){let t;return{c(){t=h("div"),t.innerHTML=`<div class="tlwd-animate-spin tlwd-w-4 tlwd-h-4 tlwd-border-2 tlwd-border-gray-600 tlwd-border-t-blue-500 tlwd-rounded-full"></div>
                    Waiting for response...`,o(t,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-text-gray-400")},m(e,n){D(e,t,n)},p:Q,d(e){e&&j(t)}}}function at(l){let t;return{c(){t=J(l[8])},m(e,n){D(e,t,n)},p(e,n){n[0]&256&&fe(t,e[8])},d(e){e&&j(t)}}}function Me(l){let t,e,n,r,s,a,i,m,g,w=l[10].canRetry&&Ee(l),u=l[10].canRetryWithoutContext&&Se(l);return{c(){t=h("div"),e=h("div"),e.textContent="Error Recovery Options",n=k(),r=h("div"),w&&w.c(),s=k(),u&&u.c(),a=k(),i=h("button"),i.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="tlwd-w-3 tlwd-h-3"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"></path></svg>
                      Open in New Tab`,o(e,"class","tlwd-text-xs tlwd-text-gray-400 tlwd-mb-3"),o(i,"class","tlwd-px-3 tlwd-py-1.5 tlwd-text-xs tlwd-bg-gray-600 hover:tlwd-bg-gray-700 tlwd-text-white tlwd-rounded tlwd-transition-colors tlwd-duration-200 tlwd-flex tlwd-items-center tlwd-gap-1"),o(i,"type","button"),o(r,"class","tlwd-flex tlwd-flex-wrap tlwd-gap-2"),o(t,"class","tlwd-mt-4 tlwd-pt-4 tlwd-border-t tlwd-border-gray-600")},m(c,y){D(c,t,y),d(t,e),d(t,n),d(t,r),w&&w.m(r,null),d(r,s),u&&u.m(r,null),d(r,a),d(r,i),m||(g=P(i,"click",l[16]),m=!0)},p(c,y){c[10].canRetry?w?w.p(c,y):(w=Ee(c),w.c(),w.m(r,s)):w&&(w.d(1),w=null),c[10].canRetryWithoutContext?u?u.p(c,y):(u=Se(c),u.c(),u.m(r,a)):u&&(u.d(1),u=null)},d(c){c&&j(t),w&&w.d(),u&&u.d(),m=!1,g()}}}function Ee(l){let t,e,n,r,s,a;return{c(){t=h("button"),e=Z("svg"),n=Z("path"),r=J(`
                        Retry with Context`),o(n,"stroke-linecap","round"),o(n,"stroke-linejoin","round"),o(n,"d","M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"fill","none"),o(e,"viewBox","0 0 24 24"),o(e,"stroke-width",2),o(e,"stroke","currentColor"),o(e,"class","tlwd-w-3 tlwd-h-3"),o(t,"class","tlwd-px-3 tlwd-py-1.5 tlwd-text-xs tlwd-bg-blue-600 hover:tlwd-bg-blue-700 tlwd-text-white tlwd-rounded tlwd-transition-colors tlwd-duration-200 tlwd-flex tlwd-items-center tlwd-gap-1"),o(t,"type","button"),t.disabled=l[7]},m(i,m){D(i,t,m),d(t,e),d(e,n),d(t,r),s||(a=P(t,"click",l[14]),s=!0)},p(i,m){m[0]&128&&(t.disabled=i[7])},d(i){i&&j(t),s=!1,a()}}}function Se(l){let t,e,n,r,s,a;return{c(){t=h("button"),e=Z("svg"),n=Z("path"),r=J(`
                        Retry without Context`),o(n,"stroke-linecap","round"),o(n,"stroke-linejoin","round"),o(n,"d","M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"fill","none"),o(e,"viewBox","0 0 24 24"),o(e,"stroke-width",2),o(e,"stroke","currentColor"),o(e,"class","tlwd-w-3 tlwd-h-3"),o(t,"class","tlwd-px-3 tlwd-py-1.5 tlwd-text-xs tlwd-bg-orange-600 hover:tlwd-bg-orange-700 tlwd-text-white tlwd-rounded tlwd-transition-colors tlwd-duration-200 tlwd-flex tlwd-items-center tlwd-gap-1"),o(t,"type","button"),t.disabled=l[7]},m(i,m){D(i,t,m),d(t,e),d(e,n),d(t,r),s||(a=P(t,"click",l[15]),s=!0)},p(i,m){m[0]&128&&(t.disabled=i[7])},d(i){i&&j(t),s=!1,a()}}}function Pe(l){let t,e,n,r,s,a,i,m,g,w=be(l[6]),u=[];for(let c=0;c<w.length;c+=1)u[c]=Le(xe(l,w,c));return{c(){t=h("div"),e=h("div"),e.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"></path></svg>`,n=k(),r=h("select"),s=h("option"),s.textContent="Select a model";for(let c=0;c<u.length;c+=1)u[c].c();a=k(),i=h("button"),i.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5"></path></svg>`,o(e,"class","tlwd-flex tlwd-items-center"),s.__value="",V(s,s.__value),o(r,"id","open-webui-model-input"),o(r,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),o(r,"autocomplete","off"),r.required=!0,l[12]===void 0&&de(()=>l[22].call(r)),o(i,"class","tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-p-0 tlwd-m-0 tlwd-outline-none tlwd-border-none"),o(i,"type","submit"),o(t,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full tlwd-mt-2")},m(c,y){D(c,t,y),d(t,e),d(t,n),d(t,r),d(r,s);for(let f=0;f<u.length;f+=1)u[f]&&u[f].m(r,null);pe(r,l[12],!0),d(t,a),d(t,i),m||(g=P(r,"change",l[22]),m=!0)},p(c,y){if(y[0]&64){w=be(c[6]);let f;for(f=0;f<w.length;f+=1){const v=xe(c,w,f);u[f]?u[f].p(v,y):(u[f]=Le(v),u[f].c(),u[f].m(r,null))}for(;f<u.length;f+=1)u[f].d(1);u.length=w.length}y[0]&4160&&pe(r,c[12])},d(c){c&&j(t),qe(u,c),m=!1,g()}}}function Le(l){let t,e=(l[12].name??l[12].id)+"",n,r;return{c(){t=h("option"),n=J(e),t.__value=r=l[12].id,V(t,t.__value)},m(s,a){D(s,t,a),d(t,n)},p(s,a){a[0]&64&&e!==(e=(s[12].name??s[12].id)+"")&&fe(n,e),a[0]&64&&r!==(r=s[12].id)&&(t.__value=r,V(t,t.__value))},d(s){s&&j(t)}}}function ct(l){let t,e=l[1]&&ve(l);return{c(){e&&e.c(),t=Ke()},m(n,r){e&&e.m(n,r),D(n,t,r)},p(n,r){n[1]?e?e.p(n,r):(e=ve(n),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:Q,o:Q,d(n){n&&j(t),e&&e.d(n)}}}const ut=l=>{l.stopPropagation()},wt=l=>l.stopPropagation(),ft=l=>{l.stopPropagation()};function mt(l,t,e){let n=!1,r=!0,s="",a="",i="",m="",g=[],w=!0,u=!1,c="",y=!1,f=null,v=!1;const R=()=>{console.log("resetConfig");try{chrome.storage.local.clear().then(()=>{console.log("Value is cleared")})}catch(b){console.log(b),localStorage.setItem("url",""),localStorage.setItem("key",""),localStorage.setItem("model",""),localStorage.setItem("includePageContext","true")}e(3,s=""),e(4,a=""),e(12,i=""),e(6,g=[]),e(0,w=!0),e(2,r=!0),e(9,y=!1),e(8,c=""),e(7,u=!1),e(10,f=null),e(11,v=!1)},L=async b=>{var T,A;if(b.preventDefault(),!!m.trim()){if(!w){const p=`${s}/?q=${encodeURIComponent(m)}&models=${i}&web-search=true`;console.log("🔗 Opening Open WebUI in new tab with web search enabled:",{url:s,searchValue:m,model:i,fullURL:p}),window.open(p,"_blank"),e(5,m=""),e(1,n=!1);return}try{e(7,u=!0),e(9,y=!0),e(8,c=""),e(10,f=null),e(11,v=!1);let p=null,X=!1;try{console.log("📄 Extracting page content..."),p=await Promise.race([_e(),new Promise((E,z)=>setTimeout(()=>z(new Error("Content extraction timeout")),1e4))]),console.log("✅ Page content extracted successfully")}catch(E){console.warn("⚠️ Content extraction failed:",E),X=!0,e(10,f={type:"content_extraction",message:"Unable to extract page content",details:E.message,canRetryWithoutContext:!0}),e(8,c=`Unable to extract page content: ${E.message}

You can try again without page context, or retry with context.`),e(7,u=!1),e(11,v=!0);return}const $=C(m,p);console.log("🚀 Starting context-aware completion:",{userQuery:m,hasContext:!!p,contextLength:((T=p==null?void 0:p.mainContent)==null?void 0:T.length)||0});const M=await Promise.race([chrome.runtime.sendMessage({action:"fetchCompletion",url:s,key:a,isOpenAI:((A=g.find(E=>E.id===i))==null?void 0:A.owned_by)==="openai",inlineMode:!1,payload:{model:i,messages:[{role:"system",content:"You are a helpful assistant. When provided with page context, use it to give more relevant and specific answers to the user's questions."},{role:"user",content:$}],stream:!0}}),new Promise((E,z)=>setTimeout(()=>z(new Error("API request timeout")),3e4))]);if(!M.success)throw new Error(M.error)}catch(p){console.error("❌ Context-aware query failed:",p);const X=p.message.includes("timeout")||p.message.includes("network")||p.message.includes("fetch"),$=p.message.includes("API")||p.message.includes("unauthorized")||p.message.includes("400")||p.message.includes("401")||p.message.includes("500");X?(e(10,f={type:"network",message:"Network connection issue",details:p.message,canRetry:!0,canRetryWithoutContext:!0}),e(8,c=`Network Error: ${p.message}

This might be due to:
• Poor internet connection
• Server is temporarily unavailable
• Request timeout

You can retry or try without page context.`)):$?(e(10,f={type:"api",message:"AI service unavailable",details:p.message,canRetry:!0,canRetryWithoutContext:!0}),e(8,c=`API Error: ${p.message}

This might be due to:
• Invalid API key or configuration
• Server maintenance
• Rate limiting

Please check your settings or try again later.`)):(e(10,f={type:"unknown",message:"Unexpected error occurred",details:p.message,canRetry:!0,canRetryWithoutContext:!0}),e(8,c=`Unexpected Error: ${p.message}

Something went wrong. You can try again or use the fallback search.`)),e(7,u=!1),e(11,v=!0),console.error("🐛 Error details:",{type:f.type,message:f.message,details:f.details,timestamp:new Date().toISOString()})}}},C=(b,T)=>{let A="";return T&&(A+=`Context: Page Title: ${T.title||"Untitled"}
`,A+=`URL: ${T.url}
`,T.metaDescription&&(A+=`Description: ${T.metaDescription}
`),T.selectedText&&(A+=`Selected Text: ${T.selectedText}
`),A+=`Content: ${T.mainContent||"No content available"}

`),A+=`User Question: ${b}

`,T&&(A+="Please answer the user's question based on the provided page context. If the context is not relevant to the question, you can provide a general answer but mention that the context may not be directly related."),A},_=async()=>{console.log("🔄 Retrying with context..."),e(10,f=null),e(11,v=!1),await L({preventDefault:()=>{}})},O=async()=>{console.log("🔄 Retrying without context...");const b=w;e(0,w=!1),e(10,f=null),e(11,v=!1);try{await L({preventDefault:()=>{}})}finally{e(0,w=b)}},Y=()=>{console.log("🔄 Falling back to normal search with web search enabled..."),window.open(`${s}/?q=${encodeURIComponent(m)}&models=${i}&web-search=true`,"_blank"),e(5,m=""),e(1,n=!1),e(9,y=!1),e(8,c=""),e(10,f=null),e(11,v=!1)},H=async()=>{try{console.log("🧪 Testing content extraction and context-aware prompt..."),console.log("📋 Toggle State:",{includePageContext:w,placeholder:w?"Ask about this page...":"Search Open WebUI"});const b=await _e();console.log("✅ Content extracted successfully:",b);const A=C("What is this page about?",b);console.log("📝 Context-aware prompt created:",A),console.log("📊 Content Summary:",{title:b.title,domain:b.domain,contentLength:b.contentLength,hasMetaDescription:!!b.metaDescription,hasSelectedText:!!b.selectedText,timestamp:b.timestamp,promptLength:A.length}),alert(`Content extraction & prompt creation successful!

Toggle State: ${w?"Enabled":"Disabled"}
Title: ${b.title}
Domain: ${b.domain}
Content Length: ${b.contentLength} chars
Prompt Length: ${A.length} chars

Check console for full details including the generated prompt.`)}catch(b){console.error("❌ Content extraction failed:",b),alert(`Content extraction failed: ${b.message}`)}},N=b=>{b.preventDefault();try{chrome.storage.local.set({url:s,key:a,model:i,includePageContext:w}).then(()=>{console.log("Value is set")})}catch(T){console.log(T),localStorage.setItem("url",s),localStorage.setItem("key",a),localStorage.setItem("model",i),localStorage.setItem("includePageContext",w.toString())}e(2,r=!1)};Ze(async()=>{let b=null;try{b=await chrome.storage.local.get()}catch(p){console.log(p)}const T=p=>{p.action==="contextStreamChunk"?e(8,c+=p.text):p.action==="contextStreamComplete"&&(console.log("🏁 Context-aware stream completed"),e(7,u=!1))};try{chrome.runtime.onMessage.addListener(T)}catch(p){console.log("Failed to add message listener:",p)}b&&(e(3,s=b.url??""),e(4,a=b.key??""),e(12,i=b.model??""),e(0,w=b.includePageContext??!0),b.url&&b.key&&b.model&&(e(6,g=await ye(b.key,b.url).catch(p=>{console.log(p),R()})),g&&e(2,r=!1)));const A=async p=>{var X,$;if(n&&p.shiftKey&&p.key==="Escape"?R():p.key==="Escape"&&(y||v?(e(9,y=!1),e(8,c=""),e(7,u=!1),e(10,f=null),e(11,v=!1)):e(1,n=!1)),p.key===" "&&(p.metaKey||p.ctrlKey)&&(p.shiftKey||p.altKey)){console.log("🔧 Search shortcut triggered"),p.preventDefault();try{const M=await chrome.runtime.sendMessage({action:"getSelection"});((M==null?void 0:M.data)??!1)&&e(5,m=M.data)}catch(M){console.log("catch",M)}e(1,n=!n),setTimeout(()=>{const M=document.getElementById("open-webui-search-input");M&&M.focus()},0)}if(a!==""&&s!==""&&p.key==="Enter"&&(p.metaKey||p.ctrlKey)&&(p.shiftKey||p.altKey)){p.preventDefault();try{console.log("🔧 Direct completion triggered");const M=await chrome.runtime.sendMessage({action:"getSelection"});if(console.log("📝 Selected text:",M==null?void 0:M.data),(M==null?void 0:M.data)??!1){console.log("✅ Text selected, starting AI completion"),await chrome.runtime.sendMessage({action:"writeText",text:`
`}),console.log("🌐 Using background script for API call");const E=await chrome.runtime.sendMessage({action:"fetchCompletion",url:s,key:a,isOpenAI:((X=g.find(z=>z.id===i))==null?void 0:X.owned_by)==="openai",inlineMode:!0,payload:{model:i,messages:[{role:"system",content:"You are a helpful assistant."},{role:"user",content:M.data}],stream:!0}});E.success?console.log("🚀 Background streaming started"):(console.error("❌ Background request failed:",E.error),await chrome.runtime.sendMessage({action:"writeText",text:`Error: ${E.error}`}))}else{console.log("⚠️ No text selected, extracting page content for summarization");try{const E=await chrome.runtime.sendMessage({action:"getPageContent"});if(E.success&&E.data){const z=E.data;console.log("📄 Page content extracted for summarization"),await chrome.runtime.sendMessage({action:"writeText",text:`
`});const De=`Task: Summarize the following article. Length: 3-5 sentences. Format: Markdown. Requirements: capture the main ideas and key points; easy to understand; summary should be free from ambiguity.

Page Title: ${z.title||"Untitled"}
URL: ${z.url}
${z.metaDescription?`Description: ${z.metaDescription}
`:""}
Content: ${z.mainContent||"No content available"}`,ae=await chrome.runtime.sendMessage({action:"fetchCompletion",url:s,key:a,isOpenAI:(($=g.find(He=>He.id===i))==null?void 0:$.owned_by)==="openai",inlineMode:!0,payload:{model:i,messages:[{role:"system",content:"You are a helpful assistant that provides clear and concise summaries of web pages."},{role:"user",content:De}],stream:!0}});ae.success?console.log("🚀 Page summarization started"):(console.error("❌ Page summarization failed:",ae.error),await chrome.runtime.sendMessage({action:"writeText",text:`Error: ${ae.error}`}))}else console.error("❌ Failed to extract page content:",E.error),await chrome.runtime.sendMessage({action:"writeText",text:`Error extracting page content: ${E.error||"Unknown error"}`})}catch(E){console.error("💥 Page content extraction error:",E),await chrome.runtime.sendMessage({action:"writeText",text:`Error extracting page content: ${E.message}`})}}}catch(M){console.error("💥 Completion error:",M);try{await chrome.runtime.sendMessage({action:"writeText",text:`Error: ${M.message}`})}catch(E){console.error("Failed to send error message:",E)}}}};return document.addEventListener("keydown",A,{capture:!0}),()=>{document.removeEventListener("keydown",A);try{chrome.runtime.onMessage.removeListener(T)}catch(p){console.log("Failed to remove message listener:",p)}}});function q(){s=this.value,e(3,s)}function S(){a=this.value,e(4,a)}const I=async()=>{s.endsWith("/")&&e(3,s=s.slice(0,-1)),e(6,g=await ye(a,s))};function x(){i=Ye(this),e(12,i),e(6,g)}function W(){w=this.checked,e(0,w)}const ne=b=>{b.key===" "&&(b.preventDefault(),b.stopPropagation(),e(0,w=!w))};function se(){m=this.value,e(5,m)}const B=()=>{e(2,r=!0)},F=()=>{navigator.clipboard.writeText(c)},U=()=>{e(9,y=!1),e(8,c=""),e(5,m=""),e(10,f=null),e(11,v=!1)},K=()=>{e(1,n=!1)};return l.$$.update=()=>{if(l.$$.dirty[0]&1&&typeof w<"u")try{chrome.storage.local.set({includePageContext:w})}catch{localStorage.setItem("includePageContext",w.toString())}},[w,n,r,s,a,m,g,u,c,y,f,v,i,L,_,O,Y,H,N,q,S,I,x,W,ne,se,B,F,U,K]}class pt extends Ue{constructor(t){super(),Be(this,t,mt,ct,Ae,{},null,[-1,-1])}}function gt(l){let t,e,n;return e=new pt({}),{c(){t=h("div"),lt(e.$$.fragment),o(t,"class","extension-container")},m(r,s){D(r,t,s),je(e,t,null),n=!0},p:Q,i(r){n||(Fe(e.$$.fragment,r),n=!0)},o(r){tt(e.$$.fragment,r),n=!1},d(r){r&&j(t),Oe(e)}}}class ht extends Ue{constructor(t){super(),Be(this,t,null,gt,Ae,{})}}new ht({target:document.getElementById("extension-app")});
